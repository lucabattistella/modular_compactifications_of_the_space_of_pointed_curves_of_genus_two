
\documentclass[11pt]{amsart}
\usepackage[english]{babel}
\usepackage[margin=1.6in]{geometry}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
%\usepackage{showlabels}
\usepackage{amsthm}

\usepackage[english]{babel}
\usepackage{yfonts}
\usepackage[T1]{fontenc}
\usepackage[utf8x]{inputenc}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{verbatim}
\usepackage{faktor}
\usepackage{xcolor}
\usepackage{xfrac}
\usepackage{tikz,tikz-cd}
\usepackage[all]{xy}
\usepackage{hyperref}
\usepackage[normalem]{ulem}

\usepackage{calrsfs}
\DeclareMathAlphabet{\pazocal}{OMS}{zplm}{m}{n}

\newcommand{\M}[4]{\overline{\pazocal M}_{#1,#2}(#3,#4)}
\newcommand{\PP}{\mathbb P}
\renewcommand{\k}{\mathbf k}
\newcommand{\m}{\mathfrak m}
\newcommand{\tR}{\widetilde{R}}
\newcommand{\tm}{\widetilde{\mathfrak m}}
\newcommand{\OO}{\mathcal O}
\renewcommand{\to}{\rightarrow}
\newcommand{\pr}{\rm{pr}}
\newcommand{\Aaff}{\mathbb A}
\newcommand{\N}{\mathbb N}
\newcommand{\oM}{\overline{\pazocal M}}
\newcommand{\tM}{\widetilde{\pazocal M}}
\newcommand{\R}{\operatorname{R}}
\newcommand{\Gm}{\mathbb{G}_{\rm{m}}}
\newcommand{\Ga}{\mathbb{G}_{\rm{a}}}
\newcommand{\vir}[1]{[#1]^{\rm{vir}}}
\newcommand{\virloc}[1]{[#1]^{\rm{vir}}_{\rm{loc}}}
\newcommand{\dvr}{\Delta}

\newcommand{\bq}{\begin{equation}}
\newcommand{\eq}{\end{equation}}
\newcommand{\ba}{\begin{aligned}}
\newcommand{\ea}{\end{aligned}}
\newcommand{\be}{\begin{enumerate}}
\newcommand{\ee}{\end{enumerate}}
\newcommand{\bsm}{\left(\begin{smallmatrix}}
\newcommand{\esm}{\end{smallmatrix}\right)}                   
\newcommand{\bpm}{\begin{pmatrix}}
\newcommand{\epm}{\end{pmatrix}}
\newcommand{\barr}{\begin{displaymath}\begin{array}{cccc}}
\newcommand{\earr}{\end{array}\end{displaymath}}
\newcommand{\barrl}{\begin{displaymath}\begin{array}{lcl}}
\newcommand{\earrl}{\end{array}\end{displaymath}}
\newcommand{\barl}{\begin{displaymath}\begin{array}{l}}
\newcommand{\earl}{\end{array}\end{displaymath}}
\newcommand{\bxym}{ \begin{displaymath}\xymatrix }
\newcommand{\exym}{\end{displaymath}}
\newcommand{\bcd}{\begin{center}\begin{tikzcd}}
\newcommand{\ecd}{\end{tikzcd}\end{center}}

\newcommand{\tr}{{\rm tr}}
\newcommand{\Isom}{\text{Isom}}
\newcommand{\Spec}{\underline{\operatorname{Spec}}}
\newcommand{\Proj}{\operatorname{Proj}}
\newcommand{\Pic}{\operatorname{Pic}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\hhom}{\mathcal{H}\!om}
\newcommand{\Aut}{\operatorname{Aut}}
\newcommand{\lev}{\operatorname{lev}}
\newcommand{\id}{{\rm id}}

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{conj}{Conjecture}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{defprop}[thm]{Definition-Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem*{teo*}{Theorem}
\newtheorem*{matteo*}{Main Theorem}
\newtheorem{ipotesi}{ipotesi}
\newtheorem*{nota}{Nota}
\newtheorem{claim}{Claim}
\newtheorem{question}[thm]{Question}

\theoremstyle{definition}
\newtheorem{example}[thm]{Example}
\newtheorem{ex}[thm]{Example}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{remark}[thm]{Remark}
\newtheorem{com}[thm]{Comment}
\newtheorem{num}{Number}
\newtheorem*{sketch}{Sketch}
\newtheorem{rem}[thm]{Remark}


\newcommand{\todo}[1]{\vspace{5mm}\par \noindent
\framebox{\begin{minipage}[c]{0.95 \textwidth} \tt #1\end{minipage}} \vspace{5mm} \par}

\def\ti{-\allowhyphens}
\newcommand{\thismonth}{\ifcase\month % case 0 --- impossible!
  \or January\or February\or March\or April\or May\or June%
  \or July\or August\or September\or October\or November%
  \or December\fi}
\newcommand{\thismonthyear}{{\thismonth} {\number\year}}
\newcommand{\thisdaymonthyear}{{\number\day} {\thismonth} {\number\year}}

\title{Modular compactifications of $\pazocal{M}_{2,n}$ I}
\author{Luca Battistella}
\date{\today}

\setcounter{tocdepth}{1}
\begin{document}

\begin{abstract}


\end{abstract}

\maketitle
\tableofcontents

\section{Introduction}
One of the most beautiful and influential results of modern algebraic geometry is the construction of a modular compactification of the stack of smooth pointed curves $\pazocal M_{g,n}$, due to P. Deligne and D. Mumford \cite{DM}, through the introduction of \emph{stable} pointed curves.

\begin{dfn}
 Assume $2g-2+n>0$. A connected, reduced, complete curve $C$ with distinct markings $(p_1,\ldots,p_n)$ is \emph{stable} if:
 \begin{enumerate}
  \item $C$ has only nodes as singularities, and $p_i$ are smooth points of $C$;
  \item every rational component of $C$ has at least three special points (markings or nodes).
 \end{enumerate}
\end{dfn}

\begin{thm}
 Assume $2g-2+n>0$. The moduli stack of stable pointed curves $\oM_{g,n}$ is a smooth and proper connected DM stack over $\operatorname{Spec}(\mathbb Z)$, with projective coarse moduli space $\overline{\mathbf M}_{g,n}$. The boundary $\oM_{g,n}\setminus\pazocal M_{g,n}$, representing nodal curves, is a normal crossing divisor.
\end{thm}
On one hand, the Deligne-Mumford compactification has every desirable property one can hope for; on the other, it is not unique, and it is an interesting deep question to classify all possible modular compactifications of $\pazocal M_{g,n}$ - a natural partial answer has been given by D.I. Smyth \cite{SMY-towards}.

Even though the existence of $\overline{\mathbf M}_{g,n}$ can be deduced from nowadays standard general theory on stacks \cite{KM}, this space was first constructed by means of GIT \cite{Gieseker,GIT,BalSwi}. The study of alternative compactifications of $\pazocal M_{g,n}$ is motivated as well by an interest in the birational geometry of $\overline{\mathbf M}_{g,n}$, and it is not by chance that the first steps in this direction were moved from a GIT perspective - by changing the invariant theory problem or the stability condition, and realising that the resulting quotient still enjoys a modular interpretation \cite{Schubert,Hassettg2}. The consequent program that goes under the name of B. Hassett and S. Keel aims to describe all the different possible quotients, and to understand whether every step of a minimal model program for $\overline{\mathbf M}_{g,n}$ can be given a modular interpretation in terms of curves with worse than nodal singularities. Since the early stages of this study, it has developed into a fascinating playground for testing implementations of ideas originating from GIT into a general structural theory for Artin stacks \cite{AFS1,AFS2,AFS3,CTV}.

Only few steps of the Hassett-Keel program have been carried out in full generality. On the other hand, the program has been completed to a larger extent in low genus: with the introduction of weighted pointed curves \cite{Hassettweighted} in genus zero, and with Smyth's pioneering work in genus one \cite{SMY1,SMY2,SMY3}.

Smyth extended earlier work of Schubert by following the philosophy that an alternative compactification can be defined by allowing a reasonably larger class of singularities (\emph{local condition}), studying their stable models, and disallowing the latter by imposing a stronger stability condition (\emph{global condition}); this ensures that the resulting moduli problem be again separated and universally closed, by the valuative criterion.

A useful notion in this respect is that of the \emph{genus} of an isolated curve singularity: let $(C,x)$ be (the germ of) a reduced curve over an algebraically closed field $\k$ at its unique singular point $x$, with normalisation $\nu\colon\widetilde{C}\to C$.
\begin{dfn}\label{def:genus}
Let $C$ have $m$ branches at $x$, and $\delta$ the $\k$-dimension of $\nu_*\OO_{\widetilde C}/\OO_C$, which is a skyscraper sheaf supported at $x$. The genus of $(C,x)$ is then
\[g=\delta-m+1.\] 
\end{dfn}
It can be thought of as the number of conditions that a function must satisfy in order to descend from the seminormalisation to $C$. It is a notion adapted to work in families, in the sense that a complete, reduced curve $C$ with only one singular point at $x$ and normalisation a disjoint union of $m$ copies of $\PP^1$ will appear in a family of curves of arithmetic genus $g$.

Smyth found that, for every fixed number of branches $m$, there is a unique germ of Gorenstein singularity of genus one up to isomorphism, namely:
\begin{description}
 \item[$m=1$] the cusp, $V(y^2-x^3)\subseteq\Aaff^2_{x,y}$;
 \item[$m=2$] the tacnode, $V(y^2-yx^2)\subseteq\Aaff^2_{x,y}$;
 \item[$m\geq 3$] the union of $m$ general lines in $\Aaff^{m-1}$.
\end{description}
Singularities of this kind, with up to $m$ branches, together with nodes, form a deformation-open class of singularities. Furthermore, the elliptic $m$-fold point can be obtained by contracting a smooth elliptic curve with $m$ rational tails in a one-parameter smoothing, and, roughly speaking, all stable models look like this.
\begin{dfn}\cite{SMY1}
 For $m<n$, a connected, reduced, complete curve $C$ of arithmetic genus one with smooth distinct markings $(p_1,\ldots,p_n)$ is $m$-stable if:
 \begin{enumerate}
  \item it has only nodes and elliptic $l$-fold points, $l\leq m$, as singularities;
  \item for every connected subcurve $E\subseteq C$ of arithmetic genus one, its \emph{level} $\lvert E\cap\overline{C\setminus E}\rvert+\lvert\{i\colon p_i\in E\}\rvert$ is strictly bigger than $m$;
  \item $H^0(C,\Omega_C^\vee(-\sum_i p_i))=0$.
 \end{enumerate}
\end{dfn}
The latter can be thought of as a decency condition on the moduli stack. The second one is instead essential in guaranteeing the uniqueness of $m$-stable limits, seen the discussion above. Smyth's main result is the following.
\begin{thm}\cite{SMY1,SMY2}
 The moduli stack of $m$-stable curves $\oM_{1,n}(m)$ is a proper irreducible DM stack over $\operatorname{Spec}\mathbb Z[1/6]$. It is not smooth for $m\geq 6$.
\end{thm}

\subsection{Outline of results}
Here are the main novelties of our construction. It is not a semistable compactification (see \cite[Definition 1.2]{SMY-towards}), in that we allow dangling singularities of type $I\!I$ (see ??? below for a definition), whose normalisation has a one-pointed rational component. The necessity to do so was prefigured in \cite{AFSGm} already.

The dualising line bundle of a minimal (with no separating nodes) Gorenstein curve of genus one is trivial \cite[Lemma 3.3]{SMY1}. This plays a fundamental role in the study of semistable tails, as well as in the boundedness of the moduli functor. On the other hand the dualising line bundle of a minimal Gorenstein curve of genus two $Z$ has degree two. For this reason we had to desymmetrise the problem and use the first marking as a reference point, in order to write $\omega_Z=\OO_Z(q_1+\bar q_1)$ whenever needed, where $q_1$ is the point of $Z$ closest to $p_1$, and $\bar q_1$ is conjugate to $q_1$ (it is not always defined uniquely).

\subsection{Future directions}
\begin{enumerate}
 \item Resolve the indeterminacy of the rational map $\oM_{2,n}(m_1)\dashrightarrow\oM_{2,n}(m_2)$; we expect the construction to rely on a semistable compactification of the crimping spaces of the genus two singularities, as in \cite[\S 1.10]{vdW} and \cite{SMY3}. It would be interesting to put this work in the context of the Hassett-Keel program, as in \cite{SMY2}. More generally, a question outstanding to our knowledge is whether the whole program fits in the theoretical framework developed in \cite{DHLinstability}.
 \item Our main motivation to start this project arose from Gromov-Witten theory. In genus one, the link between reduced Gromov-Witten invariants (see for example \cite{VZ,Zingerred,LZ}) and maps from singular curves (see \cite{VISC}) was partially uncovered in \cite{BCM}, and brought in plain light in \cite{RSPW1,RSPW2}. With F. Carocci we are investigating whether similar techniques may serve to desingularise the main component of the space of genus two maps to projective space. If this is the case, they will provide a clear definition of reduced invariants, and hopefully ease the access to comparison (standard vs. reduced) results. We expect there will be a(n iso)morphism to the modular blow-up constructed in \cite{HLN}. This might lead to a mathematical definition of all-genera Gopakumar-Vafa invariants, one day.
\end{enumerate}

\section{Gorenstein curve singularities of genus two}
In this and the next sections we work over an algebraically closed field of characteristic different from $2,3,5$. We provide an algebraic classification of the (complete) local rings of Gorenstein curve singularities of genus two.

Let $(C,x)$ be the germ of a curve singularity, and let $(R,\m)$ denote $(\hat\OO_{C,x},\m_x)$, with normalisation $(\tR,\tm)\simeq\left(\k[[t_1]]\oplus\ldots\oplus\k[[t_m]],\langle t_1,\ldots,t_m\rangle\right)$.
Here $m$ is the number of branches. Recall from Definition \ref{def:genus} that the genus is:
\[g=\delta-m+1,\]
so, for genus two, $\delta=m+1$. Following \cite[Appendix A]{SMY1}, we consider $\tR/R$ as a $\mathbb Z$-graded module with:
\[ (\tR/R)_i:=\tm^i/(\tm^i\cap R)+\tm^{i+1};\]
furthermore, Smyth (\emph{loc.cit.}) notices that:
\begin{enumerate}
\item $m+1=\delta(p)=\sum_{i\geq 0}\dim_\k(\tR/R)_i;$
\item $2=g=\sum_{i\geq 1}\dim_\k(\tR/R)_i;$
\item if $(\tR/R)_i=(\tR/R)_j=0$ then $(\tR/R)_{i+j}=0$.
\end{enumerate}
We will also find the following observations to be useful:
\begin{enumerate}[resume]
 \item $\sum_{i\geq k}(\tR/R)_i$ is a grading of $\tm^k/(\tm^k\cap R)$;
 \item there is an exact sequence of $R/\m=\k$-modules:
 \[ 0\to A_k:=\frac{\tm^k\cap R}{\tm^{k+1}\cap R}\to \frac{\tm^k}{\tm^{k+1}}\to \left(\tR/R\right)_k\to 0\]
\end{enumerate}
\begin{lem}\label{lem:unibranch}
 There are two unibranch curve singularities of genus two; only one of them is Gorenstein, the $A_4$-singularity or \emph{ramphoid cusp}: $V(y^2-x^5)\subseteq\Aaff^2_{x,y}$.
\end{lem}
\begin{proof}
 In the unibranch case $\dim_\k(\tR/R)_1\leq 1$, hence equality must hold (by observation (3) above). We are left with two cases:
 \begin{itemize}[leftmargin=15pt]
  \item Either $\dim_\k(\tR/R)_2=1$ and $\dim_\k(\tR/R)_i=0$ for all $i\geq 3$: in this case $\tm^3\subseteq\m$ by observation (4). From (5) we see that $\tm^3=\m$, hence $R\simeq\k[[t^3,t^4,t^5]],$ a spatial non-Gorenstein singularity.
  
  \item Or $\dim_\k(\tR/R)_3=1$ and $\dim_\k(\tR/R)_i=0$ for $i=2$ and for all $i\geq 4$: in this case $\tm^4\subseteq\m$ by observation (4). On the other hand from $\dim_\k(\tm^2\cap R/\tm^3\cap R)=1$ we deduce that there is a generator of degree $2$, and from $\dim_\k(\tm^3\cap R/\tm^4\cap R)=0$ there is none of degree $3$. We may write the generator as $x=t^2+ct^3$, and $\m=\langle x\rangle+\tm^4$. Up to a coordinate change (i.e. automorphism of $\k[[t]]$), we may take $x=t^2$, and \[\m/\m^2=\langle t^2,t^5\rangle,\] so $R\simeq\k[[x,y]]/(x^5-y^2)$, as anticipated.
 \end{itemize}
\end{proof}


 \begin{comment}
 In case $m=2$ we have three cases:
 \begin{itemize}[leftmargin=0pt]
  \item $\dim_\k(\tR/R)_1=2$ and $\dim_\k(\tR/R)_i=0$ for all $i\geq 2$: in this case $\tm^2\subseteq\m$ by observation (4); in facts they are equal. Then \[\m/\m^2=\langle t_1^2,t_1^3,t_2^2,t_2^3\rangle\] is the transversal union of two cusps in $\Aaff^4_\k$.
  \item $\dim_\k(\tR/R)_1=\dim_\k(\tR/R)_2=1$ and $\dim_\k(\tR/R)_i=0$ for all $i\geq 3$: in this case $\tm^3\subseteq\m$ by observation (4).
 There is a generator which we may assume is of the form: 
 \[f_1=t_1+at^n_2\in\m\;\;\text{for}\;\; n=1,2;\] on the other hand $\tm^2\cap R$ is spanned by $f_1^2$. Now, if $a=0$, does not matter if $n=1$ or $2$ and we have \[\m/\m^2=\langle t_1,t_2^3,t_2^4,t_2^5\rangle\] is the union of the non-Gorenstein unibranch singularity with a transversal axis. Otherwise we have two cases, in both we can assume wlog $a=1$. 
 \begin{description}[leftmargin=0pt]
 \item[$n=1$] then $\tm^4\subseteq\m^2$, hence \[\m/\m^2=\langle f_1,t_2^3\rangle\] and $R\simeq k[[x,y]]/y(x^3-y)$, so we have the union two smooth branches intersecting along a length $3$ sub-scheme.
 \item[$n=2$] then in $\m$ we have $t_1^2=f_1^2-t_2^4$ since $t_2^4\in\tm^3\subseteq\m;$ however this latter element in not in $\m^2$, so
 \[\m/\m^2=\langle f_1=t_1+t_2^2,t_1^2,t_2^3\rangle.\]
 The singularity we have in this case is a union of a cusp and a smooth branch (a parabola) in the 3-space with intersection of length $2$.
 \end{description}
  \item $\dim_\k(\tR/R)_1=\dim_\k(\tR/R)_3=1$ and $\dim_\k(\tR/R)_i=0$ for $i=2$ and for all $i\geq 4$: in this case $\tm^4\subseteq\m$ by observation (4). Again there is a generator of the form \[f_1=t_1+at_2^n\in\m\;\;\text{for}\;\;n=1,2,3\] but this time there is also a "quadratic generator" $f_2$ which is independent from $f_1^2$, so it has to be of the form \[f_2=bt_1^m+t_2^2\;\;\text{ for} \;\;m=2,3.\] On the other hand $f_1^3$ and $f_1f_2$ are linearly dependent modulo $\tm^4\subset\m$.
\begin{description}[leftmargin=0pt]
\item[$n=1, m=2$]In this case $f_1^3$ and $f_2f_1$ are already in $\tm^3\cup R/\tm^4$ so they need to be linearly dependent; a computation shows then that $a=0$, (otherwise we would get $f_1^2$ and $f_2$ proportional) i.e. $f_1=t_1$ and we may as well assume that $f_2=t_2^2$. Finally 
  \[\m/\m^2=\langle t_1,t_2^2,t_2^5\rangle\] 
  is the union of the Gorenstein unibranch singularity with a transversal axis. 
  \item[$n=1, m=3$] We can assume $a,b\neq 0$ otherwise we fall back in the above case; but then we see that this case does not occur because the linear dependence modulo $\tm^4$ can't be satiisfies if $a\neq 0$.
  \item[$n=2, m=2$] We can assume $a=1$ otherwise we are in the previous case; imposing linear dependence of $f_1^3,f_1f_2$ up to $\tm^4$ we find $b\neq 0$, so we may assume it is one as well and we have  \[\m/\m^2=\langle t_1+t^2,t_1^2+t_2^2,t_2^5\rangle.\]
  A change of variables show that in fact this singularity is isomorphic to the union of the ramphoidal cusp with a transversal axis. 
  \item[$n=2, m=3$] Once again we can assume $a,b\neq 0$ otherwise we are back to the $n=1,m=2$ case. Then we have that $f_1f_2$ is zero mod $\tm^4$ and $\tm^3\cup R/\tm^4$ is generated by $f_1^3.$ Once again we have 
  \[\m/\m^2=\langle f_1,f_2,t_2^5\rangle\]
  and also the singularity is isomorphic to the one above.
  \item[$n=3, m=2$] We can assume that $a=1$ for the formentioned reason and it easy to see that we can always reduce to the case where the second generator has $b=0;$ the we compute the generators to be:  \[\m/\m^2=\langle f_1=t_1+t_2^3,f_2=t_2^2,\rangle\]
  and thus we get a planar singularity with local equation $x(y^2-x^3),$ i.e. the union of a line and a cusp in the plane intersecting in a length $2$ sub-scheme.
  \item[$n=3, m=3$] The same type of arguments we have been using so far shows that in this case we get again the planar singularity $x(y^2-x^3).$
  \end{description}
 \end{itemize}


\begin{remark}
It seems that the genus $2$ case is significantly more difficult that the genus $1$ due to the fact that in this case we need to consider non homogeneous generators. It does seem hopeless to perform the classification for an arbitrary number of branches.
 However, we see that each 2-branches genus $2$ singularity is obtained by gluing two singularities $R_1$ and $R_2$ with $g(R_i)\leq 2$ along a closed sub-scheme of length $\leq 3.$ 
 This is clear if we look at the factorisation of the normalisation $R\hookrightarrow \widetilde{R}=k[[t_1]]\oplus k[[t_2]]$ 
 through $R\hookrightarrow R_1\oplus \R_2\hookrightarrow \widetilde{R},$ where 
 the first partial normalisation correspond to separate the branches. Algebraically this can be achieved considering the $k$ subvector space $K^{\rm{br}}$ of $\widetilde{R}/R$ generated by those conditions involving only one branch at the time an then taking the Kernel of $\widetilde{R}\to K^{\rm{br}}.$
\end{remark}\end{comment}
From now on, we are going to study only Gorenstein singularities. With notation as above, let $I=(R:\tilde R)=\operatorname{Ann}_R(\tilde R/R)$ be the conductor ideal of the singularity. Recall (see e.g. \cite[Theorem 6.4]{Hun}) that $(C,x)$ is Gorenstein iff :
\[\dim_\k(R/I)=\dim_\k(\tR/R)(=\delta).\]

Recall from \cite[Definition 2-1]{Stev} that a curve singularity $(C,p)$ is \emph{decomposable} if $C$ is the union of two curves $C_1$ and $C_2$ that lie in distinct smooth spaces intersecting each other transversely in $p$. Given a parametrisation $x_i=x_i(t_1,\ldots,t_m),\ i=1,\ldots,n$, this means that we can find a partition $S\sqcup S^\prime=\{1,\ldots,m\}$ such that $x_i$ only depends on $t_s,s\in S$, or $s\in S^\prime$, for all $i$. Recall from \cite[Proposition 2.1]{AFSGm} that, aside from the node, Gorenstein singularities are never decomposable.

\begin{prop}\label{prop:classification}
 For every fixed integer $m\geq 2$, there are exactly two Gorenstein curve singularities of genus two with $m$ branches.
\end{prop}
\begin{proof}
 We wish to find a basis for $\m/\m^2$, because a map of complete local rings that is surjective on cotangent spaces is surjective. We use the filtrations above.
 
 \textbf{Case I}: $(2,0,0)$. We see that $\tm^2\subseteq I$, so (by the Gorenstein assumption) $m+1=\delta=\dim_\k(R/I)\leq \dim_\k(R/\tm^2)=\dim_\k A_0+\dim_\k A_1=m-1$, contradiction. We note that in this case the singularity is decomposable.
 
 \textbf{Case II}: $(1,1,0)$. We have $\tm^3\subseteq I$. We are going to write down the $m-1$ generators of $A_1$ ($\operatorname{mod} \tm^3$)\footnote{To make them into the simplest possible form, we allow ourselves to perform linear algebra operations at first, and only at the end we may change coodinates - the benefit of this two-step process will become apparent in the next section.}. The first generator, call it, $x_1$, has a non-trivial linear term in at least one of the variables, wlog $t_1$. By scaling $x_1$ and possibly adding a multiple of $x_1^2$, we can make it into the form:
 $x_1=t_1\oplus p_{1,2}(t_2)\oplus\ldots\oplus p_{1,m}(t_m) \mod\tm^3.$ Now we can use $x_1$ and $x_1^2$ to make sure the second generator does not involve $t_1$ at all. It will still have a linear term independent of $t_1$, say non-trivial in $t_2$. By scaling and adding a multiple of $x_2^2$, we can write $x_2=0\oplus t_2\oplus\ldots\oplus p_{1,m}(t_m) \mod\tm^3.$ By taking a linear combination of $x_1$ with $x_2$ and $x_2^2$, we may now reduce $x_1$ to the form $t_1\oplus0\oplus p_{1,3}(t_3)\oplus\ldots\oplus p_{1,m}(t_m)\mod\tm^3$. Therefore, by Gaussian elimination with the generators and their squares, we may assume that
 \begin{align*}
  x_1= & t_1\oplus0\oplus\ldots\oplus\alpha_{1,m}t_m+\beta_{1,m}t_m^2\\
  x_2= & 0\oplus t_2\oplus\ldots\oplus\alpha_{2,m}t_m+\beta_{2,m}t_m^2\\
  &\ldots\\
  x_{m-1}= & 0\oplus\ldots\oplus t_{m-1}\oplus\alpha_{m-1,m}t_m+\beta_{m-1,m}t_m^2 \mod \tm^3\\
 \end{align*}
 We must have $R/I=\langle 1,x_1,\ldots,x_{m-1},y\rangle$ by the Gorenstein condition (if $x_i\in I$, then $t_i\in R$, and it is then easy to see that the singularity would be decomposable). Hence $x_i^2\in I$ for all but at most one $i$, say $i=1$. Then $t_i^2\in R$ for $i=2,\ldots,m-1$. If $\alpha_{i,m}\neq 0$ for some $i$ in this range, then $t_m^2\in R$ as well, so $t_1^2=x_1^2-O(t_m^2)\in R$, contradicting $\dim_\k(\tR/R)_2=1$. Therefore $\alpha_{i,m}=0$ for $i\in\{2,\ldots,m-1\}$. If $\alpha_{1,m}=0$, then we need a further generator of $\m/\m^2$, namely $z=0\oplus\ldots\oplus t_m^3$. In this case, though, both $x_1^2$ and $z$ belong to $I$, so $\dim_k(R/I)=m$, and the singularity cannot be Gorenstein. We have then:
 \begin{align}\label{coordII-cs}
 \begin{split}
  x_1= & t_1\oplus0\oplus\ldots\oplus\alpha_{1,m}t_m+\beta_{1,m}t_m^2\\
  x_2= & 0\oplus t_2\oplus\ldots\oplus\beta_{2,m}t_m^2\\
  &\ldots\\
  x_{m-1}= & 0\oplus\ldots\oplus t_{m-1}\oplus \beta_{m-1,m}t_m^2 \mod\tm^3,
 \end{split}
 \end{align}
 with $\beta_{1,m}\in\k$ and $\alpha_{1,m},\beta_{i,m}\in\k^\times,\ i=2,\ldots,m-1$ (by indecomposability). Finally, we may change coordinates in $t_m$ and scale the other $t_i$ to obtain
 \begin{align}\label{coordII}
 \begin{split}
  x_1= & t_1\oplus0\oplus\ldots\oplus t_m\\
  x_2= & 0\oplus t_2\oplus\ldots\oplus t_m^2\\
  &\ldots\\
  x_{m-1}= & 0\oplus\ldots\oplus t_{m-1}\oplus t_m^2\mod\tm^3.
 \end{split}
 \end{align}
 We may check that $R/I=\langle 1,x_1,\ldots,x_{m-1},x_1^2\rangle$ and $\tR/R$ is of type $(1,1,0)$. In the case $m=2$, we need an extra generator $y=t_2^3$. Equations are given by
 \begin{itemize}
  \item $y(y-x_1^3)$ if $m=2$ ($A_5$-singularity);
  \item $x_1x_2(x_2-x_1^2)$ if $m=3$ ($D_6$-singularity);
  \item $\langle x_3(x_1^2-x_2),x_i(x_j-x_k)\rangle_{1\leq i<j<k\leq m-1 \text{ or }1<j<k<i\leq m-1}$ if $m\geq 4$.
 \end{itemize}

 
 \textbf{Case III}: $(1,0,1)$. We have $\tm^4\subseteq I$. By an argument similar to the above, we write generators for $A_1$ as $x_i=\ldots\oplus t_i\oplus\ldots \oplus\alpha_{i,m}t_m+\beta_{i,m}t_m^2+\gamma_{i,m}t_m^3$, for $i=1,\ldots,m-1$.
 Then $R/I=\langle 1,x_1,\ldots,x_{m-1},y\rangle$. For all but at most one $i$, $x_i^2\in I$, but definitely $x_i^3\in I$ for all $i$. On the other hand $t_m^3\notin R$, because otherwise $t_i^3=x_i^3-\alpha_{i,m}^3t_m^3+O(t_m^4)$ would belong to $R$ as well, contradicting $\dim_\k(\tR/R)_3=1$. From this we deduce that $\alpha_{i,m}=0$ for all $i=1,\ldots,m-1$. By $\dim_\k(\tR/R)_2=0$ there has to be another generator of degree two in $t_m$, which we may write as $x_m=t_m^2+\gamma_{m,m}t_m^3$ of $\m/\m^2$. We can use $x_m$ to remove all the $t_m^2$ pieces from $x_1,\ldots,x_{m-1}$, so we are reduced to
  \begin{align}\label{coordIII-cs}
 \begin{split}
  x_1= & t_1\oplus0\oplus\ldots\oplus \gamma_{1,m}t_m^3\\
  x_2= & 0\oplus t_2\oplus\ldots\oplus \gamma_{2,m}t_m^3\\
  &\ldots\\
  x_{m-1}= & 0\oplus\ldots\oplus t_{m-1}\oplus \gamma_{m-1,m}t_m^3\\
  x_m= & 0\oplus\ldots\oplus t_m^2+\gamma_{m,m}t_m^3 \mod\tm^4,
  \end{split}
 \end{align}
 with $\gamma_{m,m}\in\k$ and $\gamma_{i,m}\in\k^\times,\ i=1,\ldots,m-1$ (by indecomposability). Finally, we may change coordinates in $t_m$ and scale the other $t_i$ to obtain
 \begin{align}\label{coordIII}
 \begin{split}
  x_1= & t_1\oplus0\oplus\ldots\oplus t_m^3\\
  x_2= & 0\oplus t_2\oplus\ldots\oplus t_m^3\\
  &\ldots\\
  x_{m-1}= & 0\oplus\ldots\oplus t_{m-1}\oplus t_m^3\\
  x_m= & 0\oplus\ldots\oplus t_m^2 \mod\tm^4.
  \end{split}
 \end{align}
 We may check that $R/I=\langle 1,x_1,\ldots,x_{m-1},x_m\rangle$ and $\tR/R$ is of type $(1,0,1)$. For $m=1$ we recover the unique Gorenstein singularity of Lemma \ref{lem:unibranch}. Equations are
 \begin{itemize}
  \item $x^5-y^2$ if $m=1$ ($A_4$-singularity or \emph{ramphoid cusp});
  \item $y(y^3-x^2)$ if $m=2$ ($D_5$-singularity);
  \item $\langle x_3(x_1-x_2),x_3^3-x_1x_2\rangle$ if $m=3$;
  \item $\langle x_i(x_j-x_k), x_m(x_i-x_j),x_m^3-x_1x_2\rangle_{i,j,k\in\{1,\ldots,m-1\}\text{ all different}}$ if $m\geq 4$.
 \end{itemize}
\end{proof}

\begin{rem}
 Not-necessarily Gorenstein singularities can be obtained by gluing various Gorenstein singularities of genus $\leq 2$ along subschemes of length $\leq 3$. Classifying all of them would not necessarily be easy.
\end{rem}

\begin{rem}
 Singularities of type II do appear in the miniversal family of singularities of type III, and viceversa. For low values of $m$ - which is the playground of al our speculations -, this follows neatly from a beautiful result of A. Grothendieck that I have learnt from \cite{C-ML} (see also \cite{Arnold,Demazure}):
 \begin{thm}
  Let $(C,p)$ be a curve singularity of ADE type. Singularities that appear in the miniversal deformation of $(C,p)$ are all and only those ADE, whose Dynkin diagram can be obtained as a full subgraph of the diagram of $(C,p)$.
 \end{thm}
\end{rem}

\begin{dfn}
 In case II, we shall call the branches parametrised by $t_1$ and $t_m$ \emph{twin}; in case III, the branch parametrised by $t_m$ is called the \emph{singular} branch. We shall refer to them as \emph{special} or \emph{distinguished} branches; all other branches are \emph{axes}. \emph{Branch} remains a generic name, indicating any of the previous ones.
\end{dfn}


\section{Tangent sheaf, crimping space, and automorphisms}
In this section we analyse the tangent sheaf of a genus two singularity. For a complete Gorenstein curve of genus two with markings, we translate the absence of infinitesimal automorphisms into a (mostly) combinatorial condition. The crimping space naturally makes its appearance in the process.


\begin{lem}
Let $(C,p)$ be a Gorenstein curve singularity of genus two, with pointed normalisation $\nu\colon(\tilde C,\{p_i\}_{i=1,\ldots,m})\to (C,p)$, and assume $\operatorname{char}(\k)\neq 2,3,5$. There is a diagram of exact sequences of sheaves
\bcd
0\ar[r]  & \nu_*\Omega_{\tilde C}^\vee(-\sum_i 3p_i)\ar[r]  &\nu_*\Omega_{\tilde C}^\vee(-\sum_i p_i)\ar[r]\ar[dr,phantom,"\Box"]  &\nu_*\bigoplus_i\Omega_{\tilde C}^\vee(-p_i)_{|2p_i}\ar[r]  & 0 \\
0\ar[r]  &\nu_*\Omega_{\tilde C}^\vee(-\sum_i 3p_i)\ar[r]\ar[u,equal]  & \Omega_C^\vee\ar[r]\ar[u] & \k^{\oplus m}\ar[r]\ar[u] & 0
\ecd
 The right-most vertical map admits an explicit description in local coordinates.
\end{lem}
\begin{proof}
 Let $K(\tilde C)$ denote the constant sheaf of rational functions on $\tilde C$. A section of $\Omega_{\tilde C}^\vee\otimes K(\tilde C)$ is contained in $\Omega_C^\vee$ iff its image under the push-forward map
 \[\nu_*\colon\nu_*\hhom(\Omega_{\tilde C},K(\tilde C))\to \hhom(\Omega_C,K(\tilde C)) \]
 lies in the subspace $\hhom(\Omega_C,\OO_C)$. We may work locally around the singular point in the coordinates studied in the previous section.
\begin{description}
 \item[$A_4$] In the coordinates $x=t^2+ct^3,y=t^4,z=t^5$ (they are redundant, but it will not matter in what follows), the section $f(t)\frac{d}{dt}\in\nu_*\Omega_{\tilde C}^\vee\otimes K(\tilde C)$ pushes forward to
 \[\nu_*\left(f(t)\frac{d}{dt}\right)=(2t+3ct^2)f(t)\frac{d}{dx}+4t^3f(t)\frac{d}{dy}+5t^4f(t)\frac{d}{dz},\]
 from which, writing $f(t)=f_0+f_1t+f_2t^2+O(t^3)$, we see that
 \[(2t+3ct^2)f(t),4t^3f(t),5t^4f(t)\in\hat\OO_{C,p}\Leftrightarrow f_0=0,cf_1+2f_2=0.\]
 \item[$A_5$] In the coordinates $x=t_1\oplus at_2+bt_2^2,y=t_1^3$, the section $f_1(t_1)\frac{d}{dt_1}\oplus f_2(t_2)\frac{d}{dt_2}$ pushes forward to
 \[\nu_*\left(f_1(t_1)\frac{d}{dt_1}\oplus f_2(t_2)\frac{d}{dt_2}\right)=\left(f_1(t_1)\oplus (a+2bt_2) f_2(t_2)\right)\frac{d}{dx}+3t_1^2f_1(t_1)\frac{d}{dy},\]
 from which, writing $f_i(t_i)=f_{i0}+f_{i1}t_i+f_{i2}t_i^2+O(t_i^3),i=1,2$, we see that
 \[f_1(t_1)\oplus (a+2bt_2)f_2(t_2),3t_1^2f_1(t_1)\in\hat\OO_{C,p} \Leftrightarrow \begin{cases} f_{10}=f_{20}=0,\\ f_{11}=f_{21},\\ 2bf_{21}+af_{22}=a^2f_{12}.\end{cases}\]
 \item[$I\!I_{m\geq 3}$] In the coordinates of \eqref{coordII-cs},
 \begin{multline*}\nu_*\left(\sum_{i=1}^m f_i(t_i)\frac{d}{dt_i}\right)=\left(f_1(t_1)\oplus(\alpha_{1,m}+2\beta_{1,m}t_m) f_m(t_m)\right)\frac{d}{dx_1}+\\
 \sum_{i=2}^m\left(f_i(t_i)\oplus2\beta_{i,m}t_mf_m(t_m)\right)\frac{d}{dx_i},\end{multline*}
 hence we deduce that
 \[\nu_*\left(\sum_{i=1}^m f_i(t_i)\frac{d}{dt_i}\right)\in\Omega_C^\vee\otimes\hat\OO_{C,p}\Leftrightarrow \begin{cases} f_{i0}=0 & \text{for } i=1,\ldots,m,\\ 2f_{11}=f_{i1}=2f_{m1}, & \text{for } i=2,\ldots,m-1,\\ \beta_{1,m}f_{m1}+\alpha_{1,m}f_{m2}=\alpha_{1,m}^2f_{12}.\end{cases}\]
  \item[$I\!I\!I_{m\geq 2}$] In the coordinates of \eqref{coordIII-cs},
 \begin{multline*}\nu_*\left(\sum_{i=1}^m f_i(t_i)\frac{d}{dt_i}\right)=\sum_{i=1}^{m-1}\left(f_i(t_i)\oplus3\gamma_{i,m}t_m^2f_m(t_m)\right)\frac{d}{dx_i}+\\(2t_m+3\gamma_{m,m}t_m^2)f_m(t_m)\frac{d}{dx_m},\end{multline*}
 hence we deduce that
 \[\nu_*\left(\sum_{i=1}^m f_i(t_i)\frac{d}{dt_i}\right)\in\Omega_C^\vee\otimes\hat\OO_{C,p}\Leftrightarrow \begin{cases} f_{i0}=0 & \text{for } i=1,\ldots,m,\\ f_{i1}=3f_{m1}, & \text{for } i=1,\ldots,m-1,\\ 3\gamma_{m,m}f_{m1}+2f_{m2}=0.\end{cases}\]
\end{description}
\end{proof}

From this description we see that the letters $\alpha,\beta$ and $\gamma$ will play a role in determining the automorphism group of a complete curve with markings. We recall some key concepts from F. van der Wyck's thesis.

We work over $\k$. We can consider the stack $\mathcal S$ of reduced one-dimensional $\k$-algebras $R$, and the stack $\mathcal T$ of reduced 1d algebras with resolution $(R\hookrightarrow (S,J))$, where $S$ is a smooth one-dimensional $\k$-algebra, and $J$ is the radical of the conductor of $R\subseteq S$. Basically, $R$ is the (local) ring of a reduced curve with one singular point, $S$ is its normalisation, and $J$ is the ideal of the reduced fiber over the singular point of $\operatorname{Spec}(R)$. $\mathcal S$ and $\mathcal T$ are limit-preserving stacks over $\operatorname{Spec}(\k)$ \cite[Proposition 1.21]{vdW}. Furthermore, we may fix a reduced 1d algebra with resolution $\tau_0:(R_0\hookrightarrow(S_0,J_0))$, and consider the substack $\mathcal T(\tau_0)$ of reduced 1d algebras with singularity type $\tau_0$ (i.e. isomorphic to $\tau_0$ locally on both the base and the curve, see \cite[Definition 1.64]{vdW}; that various notions of ``locally'' coincide is proved in \cite[Proposition 1.50]{vdW}). There is a forgetful morphism $\mathcal T\to\mathcal S$, and the \emph{crimping space} of $\tau_0$ is defined to be the fiber over $R_0$ of the restriction of such morphism to $\mathcal T(\tau_0)$. The crimping space is a smooth $\k$-scheme \cite[Theorems 1.70 and 1.73]{vdW}; indeed, it is isomorphic to the quotient of $\Aut_{(S_0,J_0)/\k}$ by $\Aut_{(S_0,J_0)/R_0}$, the latter being the subgroup of automorphisms of the normalisation preserving the subalgebra of the singularity; moreover, the quotient can be computed after modding out the lowest power of $J$ that is contained in $R$ \cite[Theorem 1.53]{vdW}. Crimping spaces should be thought of as moduli for the normalisation map. %We shall compute the crimping space of the genus two singularities.

\begin{lem}
 The crimping space of a genus two singularity with $m$ branches is (a number - depending on the type - of copies of) $\Aaff^1\times(\Aaff^1\setminus\{0\})^{m-1}$.
\end{lem}
\begin{proof}
We resume notation from the previous section. We are going to fix the subalgebra $\tau_0$ given in coordinates by \eqref{coordII} and \eqref{coordIII} above respectively.

\textbf{Type II}: recall that in this case $\tm^3\subseteq R$. For a $\k$-algebra $A$, let
\[G_i(A)=\{t_i\mapsto g_{i1}t_i+g_{i2}t_i^2,t_j\mapsto t_j\ |\ g_{i1}\in A^\times,g_{i2}\in A\},\]
and notice that
\[\Aut_{(\tR,\tm)}^{\mod\tm^3}(A)=(G_1\times\ldots\times G_m)\rtimes \mathfrak{S}_m(A).\]

Consider now the action of a group element of the form $(g_1,\ldots,g_m;\id_{\mathfrak{S}_m})$ on the given generators of $R$:
\begin{align*}
 x_1\mapsto& g_{11}t_1+g_{12}t_1^2\oplus\ldots\oplus g_{m1}t_m+g_{m2}t_m^2;\\
 x_i\mapsto& \ldots\oplus g_{i1}t_i+g_{i2}t_i^2\oplus\ldots\oplus g_{m1}^2t_m^2,\quad\text{for } i=2,\ldots,m-1.
\end{align*}
The former belongs to $R$ iff $g_{11}=g_{m1}$ and $g_{12}=g_{m2}$; the latter does iff $g_{i1}=g_{m1}^2$. Thus, such elements span a subgroup isomorphic to $\Gm\times\Ga^{m-1}(A)$. On the other hand, all branches are isomorphic to one another, but there is a pair of distinguished ones (parametrised by $t_1$ and $t_m$ respectively). We conclude that
\[\Aut_{\tau_0}^{\mod\tm^3}(A)=(\Gm\times\Ga^{m-1})\rtimes(\mathfrak{S}_2\times\mathfrak{S}_{m-2})(A).\]
The quotient is then isomorphic to $\binom{m}{2}$ copies of $\Aaff^1\times(\Aaff^1\setminus\{0\})^{m-1}$.

\textbf{Type III}: in this case $\tm^4\subseteq R$. For a $\k$-algebra $A$, let
\[G_i(A)=\{t_i\mapsto g_{i1}t_i+g_{i2}t_i^2+g_{i3}t_i^3,t_j\mapsto t_j\ |\ g_{i1}\in A^*,g_{i2},g_{i3}\in A\},\]
and notice that
\[\Aut_{(\tR,\tm)}^{\mod\tm^4}(A)=(G_1\times\ldots\times G_m)\rtimes \mathfrak{S}_m(A).\]

Consider now the action of a group element of the form $(g_1,\ldots,g_m;\id_{\mathfrak{S}_m})$ on the given generators of $R$:
\begin{align*}
 x_i\mapsto& \ldots\oplus g_{i1}t_i+g_{i2}t_i^2+g_{i3}t_i^3\oplus\ldots\oplus g_{m1}^3t_m^3,\quad\text{for } i=1,\ldots,m-1;\\
 x_m\mapsto& \ldots\oplus g_{m1}^2t_m^2+2g_{m1}g_{m2}t_m^3.
\end{align*}
The former belongs to $R$ iff $g_{i1}=g_{m1}^3$; the latter does iff $g_{m2}=0$. Thus such elements span a subgroup isomorphic to $\Gm\times\Ga^{m-1}\times\Ga^m(A)$. On the other hand, there is a special (singular) branch, parametrised by $t_m$. We conclude that
\[\Aut_{\tau_0}^{\mod\tm^3}(A)=(\Gm\times\Ga^{m-1}\times\Ga^m)\rtimes(\mathfrak{S}_{m-1})(A).\]
The quotient is therefore isomorphic to $m$ copies of $\Aaff^1\times(\Aaff^1\setminus\{0\})^{m-1}$. 
\end{proof}
It is now clear that the benefit of a two-step classification where at first we do not allow ourselves to change coordinates (i.e. act by automorphisms of the normalisation) is that it makes the crimping space apparent already from the expressions \eqref{coordII-cs} and \eqref{coordIII-cs} for the generators of the singularity subalgebra.

There is a more geometric way to see the crimping spaces. It is well-known that a cusp can be obtained by collapsing (\emph{push-out}) a generic (i.e. non-zero) tangent vector at $p\in\PP^1$. More generally, a Gorenstein singularity of genus one and $m$ branches can be obtained by collapsing a generic (not contained in any coordinate linear subspace) tangent line at an ordinary (i.e. rational) $m$-fold point \cite[Lemma 2.2]{SMY1}. Hence, we recover the crimping space of the elliptic $m$-fold point, which is isomorphic to $(\Aaff^1\setminus\{0\})^{m-1}$, as the maximal torus inside $\PP(T_pR_m)\simeq\PP^{m-1}$, where $(R_m,p)$ is the rational $m$-fold point. Besides, this gives a natural compactification of the crimping space supporting a universal family of curves - in fact, two: either we collapse non-generic tangent vectors, obtaining non-Gorenstein singularities along the boundary (this family $\mathcal C$ has a common normalisation, that is the trivial family $\widetilde{\mathcal C}=R_m\times \PP(T_pR_m)$); or we blow-up $\widetilde{\mathcal C}$ along the boundary (\emph{sprouting}), and we replace the non-Gorenstein singularities by more elliptic $m$-fold points, this time with strictly semistable branches \cite[\S 2.2-3]{SMY2}.

Similarly, a Gorenstein singularity of genus two admits a partial normalisation by a non-Gorenstein singularity of genus one: type $\tau_0^{II}$ by $\sigma_0^{II}$, which is the decomposable union of a tacnode in the $(t_1,t_m)$-plane together with $m-2$ axes, by adjoining the generator $t_m^2$; and type $\tau_0^{III}$ by $\sigma_0^{III}$, which is the decomposable union of a cusp (parametrised by $t_m$) together with $m-1$ axes, by adjoining $t_m^3$. These fit together nicely in the following picture: if we restrict $\mathcal C$ from the previous paragraph to the union of the coordinate lines in $\PP(T_pR_m)$, we obtain $m$ copies of $\sigma_0^{III}$ over the points, together with $\binom{m}{2}$ copies of the crimping space of $\sigma_0^{II}$ - which is isomorphic to $\Aaff^1\setminus\{0\}$ - over the open lines.

Let $V_m$ be the tangent space to a rational $m$-fold point $R_m$ at its singular point $p$. Over $\PP(V_m)$ (representing linear combinations of tangent vectors, i.e. hyperplanes in $V_m^\vee$) there is a natural family of genus one singularities $E_m$ obtained by collapsing (push-out) the corresponding tangent vector in $T_pR_m$, considered already in \cite[\S2.2]{SMY2}. Observe now that there is a $\Gm$-worth of $\sigma_0^{II}$ singularities corresponding to choosing a generic tangent vector in the plane $T_pA_1\oplus T_pA_m$ (where $A_i$ stands for the $i$-th axis); these degenerate to a singularity of type $\sigma_0^{III}$ when the tangent vector becomes parallel to $T_pA_m$. Up to relabelling the branches, we see that the interesting for us locus $L$ consists of the $\binom{m}{2}$ coordinate lines, together with the $m$ coordinate points in $\PP(V_m)$. The restriction of $E_m$ to $L$ gives a family of singularities of type $\sigma_0$ (II and III). The crimping space of the Gorenstein singularities of genus two dwells as an open subscheme inside $P=\PP(T_p E_m|_L)$. It is geometrically clear that the generic fiber over a coordinate line is $\PP^{m-1}$, in which $\Gm^{m-2}\times\Ga$ is carved by removing the $m-1$ hyperplanes generated by (a) the tangent line to the tacnode and the $m-2$ axes, and (b) the plane containing the tacnode and all but one of the $m-2$ axes. On the other hand, the fiber over the coordinate points is $\PP^m$, in which $\Gm^{m-1}\times\Ga$ is carved by removing the $m$ planes generated by (a) the tangent cone of the cusp and the $m-1$ axes, and (b) the plane containing the cusp and all but one of the $m-1$ axes. \textbf{Question}: what are the singularities arising along such hyperplanes?

-recall crimping space and moduli of singular curves of fixed combinatorial type
-give aut/aut description of cs
-describe all the cs at once
-we suspect that the crimping space is also themoduli space of right-most vertical maps in the diagram above such that... (preserve the subalgebra of a singularity determining it, which should imply Lie subalgebra)

Recall Smyth's description of Gorenstein curves of genus one with no automorphisms \cite[Proposition 2.3, Corollary 2.4]{SMY1}.

\begin{dfn}
 Let $(C,p_1,\ldots,p_n)$ be a pointed Gorenstein curve. A connected subcurve $D\subseteq C$ is said to be \emph{nodally attached} if $D\cap\overline{C\setminus D}$ consists of nodes only. Let us call a point \emph{special} if it is either a marking or a node. For a nodal and nodally attached subcurve $D$ with normalisation $\nu\colon \tilde D\to D$, pointed by $\nu^{-1}\left((\{p_1,\ldots,p_n\}\cap D)\cup (D\cap\overline{C\setminus D})\cup\{q\in D|q\text{ node of } D\}\right)$, we shall say that \emph{DM stability holds} if every rational component has at least three special points, and every elliptic component has at least one. We say that $C$ is \emph{rDM} if DM stability holds for every nodal and nodally attached subcurve of $C$.
\end{dfn}

\begin{cor}
 Let $(C,p_1\ldots,p_n)$ be a pointed Gorenstein curve of arithmetic genus two. The condition $H^0(C,\Omega_C^\vee(-\sum_{i=1}^n p_i))=0$ is equivalent to either of the following:
 \begin{enumerate}[leftmargin=.6cm]
  \item $C$ has an $A_4$ singularity with at least one special point, and is rDM.
  \item $C$ has a singularity of type $I\!I_{m\geq 2}$: at least one of its twin branches contains a special point, each of its axes contains at least one special point, and at least one branch has at least two. Furthermore $C$ is rDM.
  \item $C$ has a singularity of type $I\!I\!I_{m\geq 2}$: each of its axes contains at least one special point, and at least one branch has at least two. Furthermore $C$ is rDM.
  \item $C$ has two elliptic $m$-fold points: each of their branches contains at least one special point, and either they share a branch, or at least one branch of each singular point contains at least two special points. Furthermore $C$ is rDM.
  \item $C$ has one elliptic $m$-fold point: if one of its branches is a genus one curve, then all the other ones contain at least a special point; if two of its branches coincide, then all branches contain at least one special point; otherwise, all branches contain at least one special point, and at least one branch has at least two. Furthermore $C$ is rDM.
  \item $C$ has only nodes and is rDM.
 \end{enumerate}
\end{cor}

\section{Dualising line bundle and semistable tails}
This is the most technical and combinatorially delicate section of the paper. We classify the nodal subcurves that can be contracted in a one-parameter smoothing in order to obtain a Gorenstein singularity of genus two. The upshot is that the shape of the curve depends on one parameter only, namely the distance of the distinguished (i.e. twin or singular) branches from the core (minimal subcurve of genus two), no matter what the latter is. This is going to play a key role in the proof that our moduli spaces are proper.

\begin{rem}
 Smyth's contraction lemma \cite[Lemma 2.13]{SMY1} carries over essentially unchanged.
\end{rem}

\begin{lem}[Contraction lemma]\label{lem:contraction}
 
\end{lem}


\begin{lem}
 Let $\nu\colon\tilde C\to C$ be the normalisation of a Gorenstein singularity of genus two, with $\nu^{-1}(p)=\{p_1,\ldots,p_m\}$. Then $\nu^*\omega_C=\omega_{\tilde C}(3p_1+2p_2+\ldots+2p_{m-1}+3p_m)$ (case II) or $\nu^*\omega_C=\omega_{\tilde C}(2p_1+\ldots+2p_{m-1}+4p_m)$ (case III).
\end{lem}
\begin{proof}
 Recall the explicit description of the dualising sheaf for curves:
 \[\omega_C(U)=\{\eta\in \Omega_{\tilde C}\otimes K(\nu^{-1}(U)) | \sum_{p_i\in\nu^{-1}(p),p\in U}\operatorname{Res}_{p_i}((\nu^*f)\eta)=0,\ \forall f\in\OO_C(U)\}.\]
 In case II, we know that $\tm^3\subseteq R$, therefore we have poles of third order at most. It is enough to study the possible polar tails. Let \[\eta=c_1\frac{\operatorname{d}t_1}{t_1^3}+b_1\frac{\operatorname{d}t_1}{t_1^2}+a_1\frac{\operatorname{d}t_1}{t_1}\oplus\ldots\oplus c_m\frac{\operatorname{d}t_m}{t_m^3}+b_m\frac{\operatorname{d}t_m}{t_m^2}+a_m\frac{\operatorname{d}t_m}{t_m}.\]
 From looking at $1\cdot\eta$ we deduce $\sum_{i=1}^m a_i=0$; from $x_i\cdot\eta$ we see $b_1+b_m=0$ (if $i=1$), and $b_i+c_m=0$ (if $i=2,\ldots,m-1$); finally from $x_i^2\cdot\eta$ we have $c_1+c_m=0$ (if $i=1$), and $c_i=0$ (if $i=2,\ldots,m-1$). Therefore $\omega_C/\nu_*\omega_{\tilde C}$ is spanned by
 \begin{align*}
  \frac{\operatorname{d}t_1}{t_1}-\frac{\operatorname{d}t_m}{t_m},\ldots,\frac{\operatorname{d}t_{m-1}}{t_{m-1}}-\frac{\operatorname{d}t_m}{t_m},\frac{\operatorname{d}t_1}{t_1^2}-\frac{\operatorname{d}t_m}{t_m^2},\\
  \bar{\eta}=\frac{\operatorname{d}t_1}{t_1^3}+\frac{\operatorname{d}t_2}{t_2^2}+\ldots+\frac{\operatorname{d}t_{m-1}}{t_{m-1}^2}-\frac{\operatorname{d}t_m}{t_m^3}.
 \end{align*}
In particular $\omega_C$ is generated by $\bar{\eta}$ as an $\OO_C$-module. Hence the first claim.

In case III, we know that $\tm^4\subseteq R$, therefore we have poles of fourth order at most. On the other hand $t_i^2\in R$ for all $i$ implies the part of order three is trivial. So let \[\eta=c_1\frac{\operatorname{d}t_1}{t_1^4}+b_1\frac{\operatorname{d}t_1}{t_1^2}+a_1\frac{\operatorname{d}t_1}{t_1}\oplus\ldots\oplus c_m\frac{\operatorname{d}t_m}{t_m^4}+b_m\frac{\operatorname{d}t_m}{t_m^2}+a_m\frac{\operatorname{d}t_m}{t_m}.\]
 From looking at $1\cdot\eta$ we deduce $\sum_{i=1}^m a_i=0$; from $x_i\cdot\eta$ we see $b_i+c_m=0$ for all $i$, and from $x_i^3\cdot\eta$ we have $c_i=0$ for all $i$. (The statement about third order poles can be evinced from $x_i^2\cdot\eta$ or from $z\cdot\eta$ indifferently.) Therefore $\omega_C/\nu_*\omega_{\tilde C}$ is spanned by
 \begin{align*}
  \frac{\operatorname{d}t_1}{t_1}-\frac{\operatorname{d}t_m}{t_m},\ldots,\frac{\operatorname{d}t_{m-1}}{t_{m-1}}-\frac{\operatorname{d}t_m}{t_m},\frac{\operatorname{d}t_m}{t_m^2}\\
  \bar{\eta}=\frac{\operatorname{d}t_1}{t_1^2}+\ldots+\frac{\operatorname{d}t_{m-1}}{t_{m-1}^2}-\frac{\operatorname{d}t_m}{t_m^4}.
 \end{align*}
In particular $\omega_C$ is generated by $\bar{\eta}$ as an $\OO_C$-module. Hence the second claim.
\end{proof}

\begin{cor}
 The dualising sheaf has multi-degree $(1,0,\ldots,0,1)$ (case II) and $(0,\ldots,0,2)$ (case III) respectively.
\end{cor}

\begin{rem}
 $H^0(C,\Omega_C^\vee(-\sum_{i=1}^np_i))=0$ implies the ampleness of $\omega_C(\sum_{i=1}^np_i)$.
\end{rem}

\begin{rem}
 Recall Smyth's \emph{balancing} condition \cite[Definition 2.11]{SMY1}, generalised by the interior of a circle around the core in \cite{RSPW1}.
\end{rem}

\begin{prop}[Semistable tails] Let $(C,p)$ be a Gorenstein singularity of genus two, with pointed normalisation $\bigsqcup_{i=1}^m(\PP^1,p_i)$. Let $\mathcal C\to\dvr$ be a one-parameter smoothing of $C$, and $\phi\colon\mathcal C^{ps}\to\mathcal C$ a birational contraction from a prestable curve. Let $(Z,p_1,\ldots,p_m)$ be $\phi^{-1}(p)$ marked with the intersection points with the rest of $\mathcal C^{ps}_0$.
 \begin{itemize}[leftmargin=.5cm]
  \item Case II: $p_1$ and $p_m$ are either on the same rational tail, attached to a Weierstrass point, or on two different tails, attached to conjugate points. In any case they are equidistant from the core. All other $p_i$ are further away from it.
  \item Case III: $p_m$ is on a tail attached to a Weierstrass point, all other $p_i$ are further away from the core.
 \end{itemize}
\end{prop}
\begin{proof}
 By Smyth's contraction lemma \cite[Lemma 2.13]{SMY1}, a semistable curve of genus two $(Z,p_1,\ldots,p_m)$ is a semistable tail iff there exists a smoothing $\mathcal C^s\to\dvr$ of a compactification obtained by adjoining an $m$-marked tail to $p_1,\ldots,p_m$, and a line bundle $\mathcal L$ on $\mathcal C^s$ of the form $\omega_{\mathcal C^s/\dvr}(D)$, with $D$ an effective divisor supported on $Z$, such that $\mathcal L$ is ample everywhere except on $Z$, where it restricts to the structure sheaf.
 
 We may split $Z$ into a core $K$ (minimal subcurve of genus two) and a number (possibly zero) of rational trees. \emph{We start by analysing the latter ones.} Observe that, by the previous lemma, in case II $p_1$ and $p_m$ are attached to a component that appears with multiplicity $2$ in $D$ (resp. in case III $p_m$ is attached to a component along which $D$ has multiplicity $3$), while all other markings lie on multiplicity $1$ components.
 
 First, we claim that no component can appear with multiplicity $0$ in $D$. Assume that this occurred along one of the rational trees. Call $S$ such a component, $R$ the one that precedes it, and $T_1,\ldots, T_h$ the ones that follow it (when sweeping the tree from the core), and let $d_A$ denote the multiplicity of the divisor $D$ along the component $A$. Then \[\deg(\mathcal L_{|S})= -2+(h+1)+d_R+\sum d_{T_i}=0,\]
 which implies that all the $d_A$ involved are $0$, since $h\geq1$ by semistability. Also, $h=1$, hence we are looking at a bead of a rational chain. Since this consideration propagates, in the long run we will span the whole of $Z$, hence showing that $Z$ is itself a rational chain, which is absurd.
 %In the long run, this implies that $d_K=0$, but this contradicts $\deg(\mathcal L_{|K})=0$, since the left-hand side is a sum of $\deg(\omega_K(-K))$ with other positive terms.
 
 Second, let's study the case $d_S=1$. We stick to the notation above; furthermore, there can be a number of $p_i$, $i\in\{2,\ldots,m-2\}$, lying on $S$, which we think of as extra tails $T_1^\prime,\ldots,T_k^\prime$ attached to $S$, but lying outside the support of $D$. Then
 \[\deg(\mathcal L_{|S})= -2+(h+k+1)-(h+k+1)+d_R+\sum d_{T_i}=0.\]
 Either $d_R=2$, $h=0$ and $k\geq 1$; or $d_R=1$, $h=1$, and $d_{T_1}=1$ (with $k$ arbitrary). In the latter case, though, we may repeat the argument on $T_1$, and we find an infinite chain in $Z$, which can be excluded. More generally, an analogous computation shows that, when balancing a component $A$ of multiplicity $d_A$, all neighbouring components of multiplicity $d_A-1$ can be safely ignored (at the same time, the number of such components is only bounded by the semistability of $Z$ and the quantity of markings).\footnote{define the trend along a rational chain and show it is unaltered by $\alpha-(\alpha-1)$-interactions}
 
 We now prove that $d_R>d_S$ in general. The previous two paragraphs deal with the case $d_S=0,1$; we may therefore assume $d_S>1$ (which in particular implies $0\leq k\leq 2$). We have
 \[\deg(\mathcal L_{|S})= -2+(h+k+1)+d_R-d_S(h+k+1)+\sum d_{T_i}=0.\]
 By proceeding from leaves to root, we can assume that $d_S>d_{T_i},\ i=1,\ldots,h$. We may therefore rewrite
 \[d_R=(d_S-1)(h+k+1)-\sum d_{T_i}+2\geq(d_S-1)(k+1)+2=d_S+1+k(d_S-1)>d_S.\]
 
In fact, we can prove as on \cite[p.893]{SMY1} that $d_R=d_S+1$, unless $d_S=2$ and either $p_1$ or $p_m$ (or both) are attached to $S$ (type II), or $d_S=3$ and $p_m\in S$ (type III). We single out the former case within the following
\begin{dfn}
 A $1$-tree is a rooted rational tree with weighted vertices, such that its leaves are all at the same distance $l$ from the root $\circ$, and the weight of a vertex $v$ is determined by $d_v=l-\operatorname{dist}(v,\circ)+1$. Legs are attached to leaves only, and every leaf has at least a leg.
\end{dfn}
Let us look at a component $S$ with $d_S=2$ and at least one of $p_1$ and $p_m$ attached to it. The balancing equation is
\[\deg(\mathcal L_{|S})= -2-(h+k+1)+d_R+\sum d_{T_i}=0,\]
with $k\in\{1,2\}$. The preceding discussion implies that $d_{T_i}=1$ for all $i=1,\ldots,h$, so $d_R=3+k$. If $k=2$, both $p_1$ and $p_m$ are on $S$ (therefore they are equidistant from the core). In this case $d_R=5$, and it can be shown inductively that the multiplicity of $D$ along a component increases by $3$ for every step we make towards the core. A similar computation shows that the same property holds in case III, when starting from a component $S$ with $d_S=3$ and $p_m$ attached to it. Let us give the following
\begin{dfn}
 A $3$-chain of weight $w$ is a rooted rational chain of length $l$ such that its leaf has weight $w$ and either one or two distinguished legs. The weight of each vertex $v$ is determined by $w+3(l-\operatorname{dist}(v,\circ))$. A $3$-trunk is obtained by adjoining a finite number of $1$-trees of length $l_i$ to a leg adjacent to a bead of weight $l_i+1$ in a $3$-chain.
\end{dfn}

Finally, say $d_S=2$ and only $p_1\in S$. Then $d_R=4$. It can again be shown that the growth rate along the chain that connects $S$ to the core is usually $2$.
\begin{dfn}
 A $2$-chain is a rooted rational chain of length $l$ such that its leaf has weight $2$ and one distinguished leg. The weight of each vertex $v$ is determined by $2+2(l-\operatorname{dist}(v,\circ))$. A $2$-tree is obtained by adjoining a finite number of $1$-trees of length $l_i$ to a leg adjacent to a bead of weight $l_i+1$ in a $2$-chain. The length of a $2$-tree is the length of its $2$-chain.
\end{dfn}
It is important to notice that this trend can break only when two $2$-trees meet; at that point the growth rate becomes $3$. Hence the following
\begin{dfn}
 A $3$-tree of type II is obtained by adjoining two $2$ trees of the same length $l$ to the two legs of a $3$-trunk of weight $4+l$. A $3$-tree of type III is a $3$-trunk with one leg and weight $3$.
\end{dfn}
It should be clear from the preceding discussion that $Z$ contains a number of $1$-trees (bounded by $m$), and either (a) one $3$-tree or (b) two $2$-trees.
%Call $P$ the component preceding $R$, and $S,Q_1,\ldots,Q_h$ those following it. By studying the degree of $\mathcal L_{|P}$ we find $d_P+\sum d_{Q_i}=6+3h$, and $d_{Q_i}\leq 3$. So $d_P$ is determined (to be $6$), unless one of the $d_{Q_i}$ is $2$, say $i=1$; but in this case $p_m\in Q_1$, so again $p_1$ and $p_m$ are equidistant from the core. This can be generalised: the growth rate on a ``special rational tail'' (one containing either $p_1$ or $p_m$) is determined and higher than that along an ``ordinary rational tail'' (which is $+1$), and it may change only if the two ``special rational tails'' meet.

Finally, let us look at the core $K$. Consider it as a one-pointed (case (a)), resp. two-pointed (case (b)) curve of genus two, by ignoring all the attachment points of the $1$-trees, and let $\bar K\in\oM_{2,1}$ (resp. $\oM_{2,2}$) be its stable model. Recall that $\bar K$ is called Weierstrass if the marking is a fixed-point of the hyperelliptic involution $\sigma$ (case (a)), resp. conjugate if the two markings are swapped by $\sigma$ (case (b)). This is well defined by the existence and uniqueness of a $\mathfrak g^1_2$. More generally, $K$ admits a non-degenerate $2:1$ morphism to $\PP^1$ such that $p_1$ is a ramification point (resp. $\{p_1,p_2\}$ is a fiber) if and only if $\bar K$ does.
\begin{enumerate}

 \item $K$ is a smooth genus two curve. In case (a), the balancing equation admits a solution if and only if $K$ is Weierstrass, while case (b) admits a solution if and only if $K$ is conjugate.
 
 \item $K$ contains two nodally attached irreducible subcurves of genus one $E_1$ and $E_2$. It is convenient to solve the balancing equation on one of them first, say $E=E_1$. If all the neighbouring components have multiplicity $d_E-1$, it's fine. If all but one of the neighbouring components have multiplicity $d_E-1$, then the last one is forced to have multiplicity $d_E-1$ as well. The case that all but two neighbouring components have multiplicity $d_E-1$ occurs when either a $2$-tree or a $3$-tree is attached to $E$ at $q$, and let $F$ be the component going towards $E_2$, with $E\cap F=\{r\}$. The case of a $2$-tree forces $d_F=d_E$ by degree reason, but then we are left to solve $q\sim r$ in $\Pic(E)$, which is impossible; on the other hand, the case of a $3$-tree imposes $d_F=d_E+1$ and $2q\sim 2r$ in $\Pic(E)$, which says that $K$ is Weierstrass. The above considerations imply that, if there are two $2$-trees, they must both be connected to the same $E$ in nodes $q_1,q_2$ such that $q_1+q_2\sim 2r$, and $d_F=d_E+1$. Finally, assume that $E_1$ and $E_2$ are connected by a chain of rational curves $R_i$ in $K$. Then it is easy to see that, if there are two $2$-trees and one of them is connected to an $R_i$, the other must be as well. Furthermore, the incoming growth rate at $E_1$ and $E_2$ must be $1$ in both cases. Hence it can be showed that the rational chain $\{R_i\}$ is symmetric, namely: in case (a) the marking is equidistant from $E_1$ and $E_2$, and in case (b) the distance between a marking and its closest (resp. furthest) $E_i$ are the same for the two markings.
 
 PICTURE
 
 \item $\bar K\in\Delta_{irr}$, or $K$ contains only one nodally attached irreducible subcurve of genus one $E$. $E$ contains two distinguished nodes $r_1$ and $r_2$ joined in $K$ by a (possibly empty) rational chain. We see as above that either a $3$-tree is attached to a point $q\in E$ satisfying $2q\sim r_1+r_2$ in $\Pic(E)$, or two $2$-trees are attached to nodes $q_1,q_2\in E$ satisfying $q_1+q_2\sim r_1+r_2$ in $\Pic(E)$, or the rational chain is not empty and the distinguished trees are attached to it. In this case, solve the balancing equation on $E$: let $d=d_E$, $d_1$ and $d_2$ be the multiplicities of the rational components attached to $r_1$ and $r_2$ respectively; then either $d_1=d_2=d-1$, or $d_1=d-1+k$, $d_2=d-1-k$ and $r_1-r_2$ is $k$-torsion in $\Pic(E)$. But, by chasing the balancing equation along the rational chain, we see that, if $d_1\geq d$, this non-decreasive trend propagates, and in fact increases when passing a distinguished bead, so that we should have $d_2>d$, which is absurd. So again the only possibility is to have a rational chain symmetric with respect to the distinguished beads.
 
 PICTURE
 
 \item Finally, the case that the normalisation of $K$ is a union of $\PP^1$. The only really new case is when a distinguished component contains two nodes such that removing them preserves connectedness. \begin{comment}It can be shown that case (a) admits solution as soon as $K$ is not the union of two $\PP^1$ along three nodes. Case (b) admits a solution if and only if either $q_1$ and $q_2$ belong to different components, or they belong to the same component and $K$ is not the union of two $\PP^1$ along three nodes.\end{comment}
 
 \begin{tikzpicture}
  \draw[fill=black] (0,0) circle(2pt) -- node[above]{$l_2$} (4,0) circle(2pt);
  \draw (0,0) to[out=-30,in=-150] node[above]{$l_3$} (4,0);
  \draw (0,0) to[out=30,in=150] node[above]{$l_1$} (4,0);
 \end{tikzpicture}
Denoting by $l_i$ the length of a rational chain and by $t_i$ the trend along it, balancing reduces to the following system in case (a) and (b).2:\footnote{I am not sure when this admits integral solutions, e.g. not if all $l_i$ are equal}
\[
\begin{pmatrix}
 1 & 1 & 1 \\ l_1+1 & -l_2-1 & 0 \\ l_1+1 & 0 & -l_3-1
\end{pmatrix}
\begin{pmatrix}
 t_1\\ t_2\\ t_3
\end{pmatrix}
=
\begin{pmatrix}
 1 \\ 0 \\ 0
\end{pmatrix}
\]

\end{enumerate}

%Say there are two special tails $T_1$ and $T_m$, intersecting $K$ at $q_1$ and $q_m$, and ordinary tails $T^\prime_1,\ldots,T^\prime_h$, meeting it at $q_1^\prime,\ldots,q_h^\prime$. Then we know from our previous computations that we need $d_K=d_{T_1}+3=d_{T_m}+3$ and $d_K=d_{T_i^\prime}+1$ for all $i$, from which we deduce that $p_1$ and $p_m$ are equidistant from the core even when they are on different rational tails, and all the other $p_i$ are further away; besides this,
%\[\omega_K(-K)(d_KK+d_{T_1}T_1+d_{T_2}T_2+\sum d_{T_i^\prime}T_i^\prime)=\omega_K(-q_1-q_m)\simeq\OO_K\]
%allows us to conclude that $q_1$ and $q_m$ have to be conjugate. In the case that $p_1$ and $p_m$ lie on the same rational tail $T$, the growth rate becomes then $4$, so that $d_K=d_T+4$ and the same computation allows us to conclude that $q$ must be Weierstrass.

\end{proof}

\section{The new moduli functors}
\begin{dfn}
 Let $(C,p_1,\ldots,p_n)$ be a reduced curve, marked by smooth points. For a \sout{nodally attached} subcurve $D\subseteq C$, \textcolor{red}{no matter what the singularities at the intersection with the rest of $C$}, we define the \emph{level} of $D$ to be the number \[ \lev(D)=\lvert D\cap\overline{C\setminus D}\rvert+\lvert\{p_1,\ldots,p_n\}\cap D\rvert.\]
\end{dfn}
\begin{dfn}
 Fix positive integers $m<n$. Let $(C,p_1,\ldots,p_n)$ be a connected, reduced, complete curve of arithmetic genus two, marked by smooth points. We say that $C$ is $m$-stable if:
 \begin{enumerate}
  \item\label{cond:sing} $C$ has only nodes; elliptic $l$-fold points, $l\leq m+1$; type $I\!I_{\leq m+1}$, and type $I\!I\!I_{\leq m}$ genus two singularities as singular points.
  \item\label{cond:lev2} If $Z$ is a connected subcurve of arithmetic genus two, then $\lev(Z)>m$.
  \item\label{cond:lev1} If $E$ is a \sout{nodally attached} subcurve of arithmetic genus one, then $\lev(E)>m+1$.
  \item\label{cond:aut} $H^0(C,\Omega_C^\vee(-\sum_{i=1}^n p_i))=0$.
  \item\label{cond:p1} If $C$ contains a singularity of genus two, $p_1$ is connected (through a rational chain) to one of the distinguished branches.
 \end{enumerate}
\end{dfn}

\begin{rem}
 The definition is not $\mathfrak{S}_n$-symmetric. In the contraction arguments below, we use the asymmetry to write down the dualising line bundle of a genus two (sub)curve $Z$ as $\omega_Z\simeq\OO_Z(q_1+\bar q_1)$, where $q_1$ is the point on $Z$ which is closest to $p_1$. Compare this with the genus one situation, where the dualising line bundle of a Gorenstein curve is trivial.
\end{rem}
\begin{rem}\label{rmk:lev1solev2}
 If there is a subcurve of genus one, condition \eqref{cond:lev1} and condition \eqref{cond:aut} jointly imply condition \eqref{cond:lev2}. Indeed, $\lev(Z)\geq\lev(E)-1$, and the only cases in which the level drops by one are: when $Z=(E,p_1,\ldots,p_{l-2},q_1,q_2)\sqcup_{\{q_1,q_2\}}(\PP^1,q_1,q_2,p_{l-1})$; and when $Z=(E,p_1,\ldots,p_{l-1},q)\sqcup_q(E^\prime,q)$, where $(E^\prime,q)$ is a one-pointed curve of genus one.
\end{rem}


\begin{lem}[boundedness]
 If $(C,p_1,\ldots,p_n)$ is an $m$-stable curve of genus two, the $N$-th power of $A=\omega_C(\sum_{i=1}^np_i)$ is very ample for every $N>2+8(m+1)$.
\end{lem}
\begin{proof}
 We need to show that, for every point $p,q\in C$ (possibly equal)
 \begin{enumerate}
  \item \emph{basepoint-freeness}: $H^1(C,A^{\otimes N}\otimes I_p)=0$;
  \item \emph{separating points and tangent vectors}: $H^1(C,A^{\otimes N}\otimes I_pI_q)=0$.
 \end{enumerate}
By Serre duality we may equivalently show that $H^0(C,\omega_C\otimes A^{-N}\otimes(I_pI_q)^\vee)=0$. Let $\nu\colon\tilde C\to C$ be the normalisation, and let $\nu^{-1}(p)=\{p_1,\ldots,p_h\}$, $\nu^{-1}(q)=\{q_1,\ldots,q_k\}$, with $h,k\leq m+1$. It follows from Proposition \ref{prop:classification} (and the analogous result of Smyth) that $\nu_*\OO_{\tilde C}(-D)\subseteq I_pI_q$ for $D=4\sum_{i=1}^hp_i+\sum_{j=1}^kq_j$ (note that $\deg(D)\leq 8(m+1)$); furthermore, the quotient is torsion, therefore, by applying $\hhom(-,\OO_C)$ and adjunction, we find $(I_pI_q)^\vee\subseteq\nu_*\OO_{\tilde C}(D)$. It is thus enough to show that $H^0(\tilde C,\OO_{\tilde C}(D)\otimes\nu^*(\omega_C\otimes A^{-N}))=0$. Finally, $\nu^*\omega_C$ has degree at most two, and $\nu^*A$ has degree at least one on any branch of $\tilde C$, hence it is enough to take $N>2+8(m+1)$.
\end{proof}

\begin{lem}[deformation openness]
 Let $(\mathcal C,\sigma_1,\ldots,\sigma_n)\to S$ be a family of curves over a Noetherian base scheme with $n$ sections. The locus \[\{s\in S|(\mathcal C_{\bar s},\sigma_1(\bar s),\ldots,\sigma_n(\bar s)) \text{ is } m\text{-stable}\}\] is Zariski-open in $S$.
\end{lem}
\begin{proof}
 Being Gorenstein is an open condition, as much as having connected fibers of arithmetic genus two. This bounds the genus of the singularities that may occur. The case $m=1$ deserves special attention. In this case, that condition \eqref{cond:sing} is open follows from acknowledging that $I\!I_2=A_5$, $I\!I\!I_1=A_4$, while tacnode, cusp, and node are $A_3$, $A_2$, and $A_1$ respectively, and from a beautiful result of Grothendieck concerning the deformation theory of ADE singularities \cite{Arnold,Demazure}. The case $m\geq 2$ simply follows from upper semicontinuity of embedded dimension and the fact that we have exhausted all possible Gorenstein singularities of genus $\leq 2$, and embedding dimension $\leq m+1$.
 
 Condition \eqref{cond:aut} translates to: the locus where the automorphism group is unramified is open in the base.
 
 The other conditions are topological, hence constructible. With Noetherian assumptions, it is enough to check their openness over a dvr scheme. Assume that the geometric generic fiber $C_{\bar\eta}$ contains two genus one subcurve $E_{1,\bar\eta}$ and $E_{2,\bar\eta}$; their closures $E_1$ and $E_2$ in $\mathcal C$ are then flat families of genus one curves over $\dvr$. If $E_{1,\bar\eta}$ and $E_{2,\bar\eta}$ are disconnected, then so are $E_1$ and $E_2$, by local constancy of the number of connected components of fibers of a flat proper morphism with \textcolor{red}{geometrically normal} fibers. If $E_{1,\bar\eta}$ and $E_{2,\bar\eta}$ are joined by a (disconnecting) node $q_{\bar\eta}$, then so are $E_{1,0}$ and $E_{2,0}$; indeed, the unique limit of $q_{\bar\eta}$ must be a singular point of the projection, but cannot be any worse than a node by local constancy of the arithmetic genus. Finally, if $E_{1,\bar\eta}$ and $E_{2,\bar\eta}$ share a branch, then so do $E_{1,0}$ and $E_{2,0}$; on the other hand, if $E_{i,\bar\eta}$ has more than one branch, then so does $E_i$. Similarly, if $C_{\bar\eta}$ contains only one subcurve of genus one, with two nodes joined by a rational chain, so does $C_0$. The upshot of this discussion is that
 \[\lvert E_{i,\bar\eta}\cap\overline{C_{\bar\eta}\setminus E_{i,\bar\eta}}\rvert=\lvert E_{i,0}\cap\overline{C_{0}\setminus E_{i,0}}\rvert.\]
 The number of markings on $E_i$ is also constant. Hence we can deduce condition \eqref{cond:lev1} for $C_{\bar\eta}$ from the same condition on $C_0$. Condition \eqref{cond:lev2} follows as in Remark \ref{rmk:lev1solev2}. Condition \eqref{cond:lev2} can be proved analogously when there is no subcurve of genus one.
 
 Finally, suppose that $C_{\bar\eta}$ has a genus two singularity, then so does $C_0$. The (union of the) distinguished branch(es) $E_{\bar\eta}$ of $C_{\bar\eta}$ is a genus one singularity, and so is its limit $E_0$ in $C_0$. It has to contain the distinguished branch(es) of $C_0$, because any subcurve contained in the union of the axes of $C_0$ has genus zero; therefore, by assumption, $E_0$ contains $p_{1,0}$. Then also $E_{\bar\eta}$ contains $p_{1,\bar\eta}$.
\end{proof}

Recall the following result of Smyth \cite[Lemma 3.3]{SMY1}.
\begin{lem}\label{lem:min1}
 A Gorenstein curve of arithmetic genus one with no disconnecting nodes $Z$ is either: a smooth elliptic curve; a ring of $r\geq 1$ $\PP^1$; or an elliptic $m$-fold point whose normalisation is the disjoint union of $m$ copies of $\PP^1$. In all these cases $\omega_Z\simeq\OO_Z$.
\end{lem}

We may provide an analogous description of minimal subcurves of genus two.
\begin{lem}\label{lem:min2}
 A Gorenstein curve of genus two with no disconnecting nodes $Z$ is either:
 \begin{enumerate}
  \item a smooth curve of genus two;
  \item the union of $E$, a Gorenstein curve of genus one with no disconnecting nodes, and $R$, a (possibly empty) rational chain, along two distinct nodes;
  \item the union of two copies of $(\PP^1,0,1,\infty)$ with three (possibly empty) rational chains $R_0, R_1, R_\infty$ joining the homonymous points;
  \item\label{case:twice1} an elliptic $m$-fold point whose normalisation is the disjoint union of either $m-1$ $\PP^1$ (two branches coincide), or $m-1$ $\PP^1$ and a Gorenstein curve of genus one with no disconnecting node (i.e. there are two genus one subcurves sharing one branch);
  \item\label{case:2} or a singularity of genus two with $m$-branches, whose normalisation is the disjoint union of $m$ copies of $\PP^1$.
 \end{enumerate}
In all cases there exists a unique $\mathfrak g^1_2$. In cases \eqref{case:twice1} and \eqref{case:2}, given a smooth point $p$ lying on a special branch, there exists a unique point $\bar p$ (possibly equal to $p$), such that $\omega_Z\simeq\OO(p+\bar p)$.
\end{lem}


\begin{prop}[Valuative criterion of properness]
 
\end{prop}
\begin{proof}
 \emph{Existence of limits.}
  We start with a smooth $n$-pointed curve of genus two over a discrete valuation field. By the semistable reduction theorem \cite[Corollary 2.7]{DM}, we may find a finite base-change $\dvr^\prime\to\dvr$ and a semistable curve $\mathcal C^\prime\to\dvr^\prime$ with regular total space, such that its generic fiber is isomorphic to the pullback of the curve we started with. By Castelnuovo's criterion, we may further assume that the central fiber contains no rational tails.
  
  Now check whether $p_1$ afferes to a Weierstrass point or not: in the former case, change base with $\pi^{\prime\prime}\mapsto(\pi^\prime)^3$, in the latter with $\pi^{\prime\prime}\mapsto(\pi^\prime)^2$; then resolve. This has the effect of replacing every node with a chain of two (resp. one) $-2$-curve. It is a technical expedient we find useful in the construction. We drop the primes from notation.
  
  Next we identify a (not necessarily connected) subcurve that needs be contracted in order to find the $m$-stable limit. The process can be thought of as drawing expanding circles on the dual graph (except, they are not always expanding). We may at any point blow-up the curve at a marking on the central fiber, and consider the strict transform of the corresponding section; thus markings can effectively be considered as legs going to infinity in the dual graph.
  
  We start from the case that the core $Z$ is irreducible. Suppose that the level of $Z$ is $l\leq m$; then we may contract (a subcurve containing) $Z$ as follows. Let $q_1$ the point of $Z$ closest to $p_1$.
 \begin{enumerate}
  \item\label{caseW} If $(Z,q_1)$ is Weierstrass, call $S_h$ the $-2$-curves closest to $\tilde Z$, and $R_h$ the second closest. Consider the line bundle
  \[\mathcal L_{j+1}=\omega_{\mathcal B_{j+1}/\dvr}(3\tilde Z+2\sum_{h=1}^{l_j-1}S_h+\sum_{h=1}^{l_j-1}R_h+\tilde \sigma_{1,j}+\ldots+\tilde\sigma_{n,j}).\]
  By the contraction lemma \ref{lem:contraction}... By the classification of semistable tails, $\mathcal C_{j+1,0}$ acquires a singularity of type $I\!I\!I_{l}$ (which works out by our initial choice of base-change), and $p_1$ is connected to the singular branch.
  \item\label{casenW} If $(Z,q_1)$ is not Weierstrass, call $R_h$ the $-2$-curves closest to $\tilde Z$. In case there is no rational tail attached to $\bar q_1$, blow up the latter point. Consider then the line bundle
  \[\mathcal L_{j+1}=\omega_{\mathcal B_{j+1}/\dvr}(2\tilde Z+\sum_{h=1}^{l_j-1}R_h+\tilde \sigma_{1,j}+\ldots+\tilde\sigma_{n,j});\]
  By the contraction lemma \ref{lem:contraction}... By the classification of semistable tails, $\mathcal C_{j+1,0}$ acquires a singularity of type $I\!I_{l}$ or $I\!I_{l+1}$ (in which case one of the twin branches is dangling), and $p_1$ is connected to one of the twin branches.
 \end{enumerate}
 More generally, in case \ref{caseW} we may draw circles around $Z$ that at each step expand by $1$ along the tail containing $p_1$ and by $3$ along all other tails. Note that at each step the number of branches is the same as the level one step before that thanks to our base-change choice. If $l$ denotes the radius of the circle along $T_1$, the line bundle
 \[\omega_{\mathcal C}\left(3lZ+\sum_{R_i\in T_1}3(l-\operatorname{dist}(R_i,Z))R_i+\sum_{R_i\not\in T_1}(l-\operatorname{dist}(R_i,Z))R_i+\sigma_1+\ldots+\sigma_n\right)\]
 performs the desired contraction.
  
 Suppose the minimal subcurve of genus two $Z$ contains two subcurves of genus one; call $E_1$ and $E_2$ the minimal such, and assume that $p_1$ afferes to $E_1$. Start drawing circles around $E_2$. If $E_2$ already has level bigger than $m+1$, stop with the circle of radius $0$. Otherwise grow the radius by $1$ at a time. The curve to be contracted is the inner disk, so the number of branches is measured by the vertices lying on the circle, and the level by the number of exciding edges. Both are non-decreasing with the radius. We exmine the Weierstrass case; the conjugate is entirely analogous. Note that at this stage we perform one meaningful step every three, due to our choice of base-change.
  \begin{enumerate}
   \item If level $\geq m+2$ is reached before the circle touches $E_1$, take the next possible $\equiv 2\mod 3$ radius, then contract the inner circle by the line bundle
   \[ \omega_{\mathcal C}((l_2+1)E_2+\sum_i \max(l_2+1-\operatorname{dist}(E_2,R_i),0)R_i\oplus\sigma_1\oplus\ldots\oplus\sigma_n)\]
   where $l_2$ is the radius of the circle around $E_2$. Consider now $E_1$: if $\lev(E_1)\leq m+1$ start expanding the circle around it. Again, either level $\geq m+2$ can be reached before touching $E_2$, or, by contracting the maximal balanced subcurve of genus one containing $E_1$, we produce a curve having two genus one singularities that share a branch. Notice that in this case $p_1$ afferes to the only genus one subcurve that may have level $\leq m+1$.
   \item Otherwise, one step before reaching $E_1$, we may contract to produce a genus one singularity with a genus one branch. If the level is $\leq m$ at this point, consider the genus two subcurve $Z$ as a whole. Observe that the line bundle we would like to consider at this point starts with weight $3$ instead of $1$ along the tail connecting $p_1$ to $E_1$. This means that it will be supported two steps further along each rational tail departing from $Z$ except the tail containing $p_1$. Note also that getting to include $E_2$ happens at a step $\equiv 0 \mod 3$, therefore including two more components on each rational tail will not make the number of branches grow above $m$. We may now continue as before, at every step expanding the circle by $1$ along $T_1$ and by $3$ along all other rational tails.
  \end{enumerate}
 In case $p_1$ is equidistant from $E_1$ and $E_2$ (it must then affere to the rational chain joining them), start by expanding a circle around the one with lower level; if they have the same level, expand them simultaneously. If at a later stage $p_1$ becomes closer to one of the two circles, proceed as above.
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 \begin{comment} We start with a smooth $n$-pointed curve of genus two over a discrete valuation field. By the semistable reduction theorem \cite[Corollary 2.7]{DM}, we may find a finite base-change $\dvr^\prime\to\dvr$ and a semistable curve $\mathcal C^\prime\to\dvr^\prime$ with regular total space, such that its generic fiber is isomorphic to the pullback of the curve we started with. By Castelnuovo's criterion, we may further assume that the central fiber contains no rational tails. We drop the prime from our notation.
 
 We may construct a zigzag diagram of birational morphisms of curves over $\dvr$, never altering the generic fiber:
 \bcd
 & \mathcal B_1\ar[dl,"p_1"]\ar[dr,"q_1"] & & \mathcal B_2\ar[dl,"p_2"] & \ldots & \mathcal B_{t-1}\ar[dr,"q_{t-1}"] & & \mathcal B_{t}\ar[dl,"p_{t}"]\ar[dr,"q_{t}"] & \\
 \mathcal C_0:=\mathcal C\ar[rr,dashed] & & \mathcal C_1\ar[r,dashed] & {} & \ldots & {}\ar[r,dashed] & \mathcal C_{t-1}\ar[rr,dashed] & & \mathcal C_t
 \ecd
 such that:
 \begin{enumerate}[label=(\roman*)]
  \item $\mathcal C_i\to\dvr$ is a Gorenstein curve of genus two, with $n$ smooth sections $\sigma_{1,i},\ldots,\sigma_{n,i}$;
  \item\label{cond:regnodes} the total space of $\mathcal C_i$ is regular at the nodes of $\mathcal C_{i,0}$;
  \item every nodally attached rational component of $\mathcal C_i$ has at least two special points;
  \item if $\mathcal C_i$ contains two subcurves of genus one, then so do all $\mathcal C_j, j\leq i$ and their minimal level sequence is non-decreasing; on the other hand, if $\mathcal C_i$ contains only subcurve of genus one, then so do all $\mathcal C_j, j\leq i$, and their minimal level sequence is non-decreasing;
  \item the level of a minimal subcurve of genus two is non-decreasing;
  \item $\mathcal C_t$ contains a genus two singularity and no disconnecting nodes.
 \end{enumerate}
 Here is the procedure:
 \begin{enumerate}
  \item\label{twogenusone} If the special fiber $\mathcal C_{i,0}$ contains two \emph{disjoint} subcurves of genus one, let $E_1$ and $E_2$ be the minimal such. Let $\mathcal B_{i+1}$ be the blow-up of $\mathcal C_i$ in the points $\{\sigma_{1,i},\ldots,\sigma_{n,i}\}\cap(E_1\cup E_2)$; these are smooth points of $\pi_i$, thus $\mathcal C_i$ is regular near them. Denote the strict transform of $\cdot$ by $\tilde{\cdot}$. $\tilde E_1$ and $\tilde E_2$ are nodally attached, hence Cartier by assumption \ref{cond:regnodes}. We may therefore consider the line bundle
  \[\mathcal L_{i+1}=\omega_{\mathcal B_{i+1}/\dvr}(\tilde E_1+\tilde E_2+\tilde \sigma_{1,i}+\ldots+\tilde\sigma_{n,i}),\]
  which is: trivial along $\tilde E_1$, $\tilde E_2$ (by adjunction and Lemma \ref{lem:min1}), and every rational tail with only two special points, except those adjacent to either $\tilde E_1$ or $\tilde E_2$; ample everywhere else. Let \[\mathcal C_{i+1}=\Proj_\dvr\pi_{\mathcal B_{i+1},*}\left(\bigoplus_{n=0}^\infty \mathcal L_{i+1}^{\otimes n}\right).\]
  By the contraction lemma \ref{lem:contraction}...
  \item\label{onegenusone} Similarly, if the special fiber $\mathcal C_{i,0}$ contains only one subcurve of genus one, which is nodally joined to itself through a rational chain, let $E$ be the minimal such subcurve. $\mathcal B_{i+1}$ is obtained by blowing up $\mathcal C_i$ in the regular points $\{\sigma_{1,i},\ldots,\sigma_{n,i}\}\cap E$. The line bundle
  \[\mathcal L_{i+1}=\omega_{\mathcal B_{i+1}/\dvr}(\tilde E+\tilde \sigma_{1,i}+\ldots+\tilde\sigma_{n,i})\]
  is again trivial on $E$ and every rational tail with only two special points, except those adjacent to $\tilde E$; ample averywhere else.
 \end{enumerate}
 Notice that the number of rationally attached rational components strictly decreases at every step, hence after finitely many steps we reach the following situation: the two genus one subcurves have a common node or branch (case \ref{twogenusone}), or the only subcurve of genus one has either two branches that meet in a node, or two coinciding branch. Under these conditions, we pass to considering the minimal genus two subcurve as a whole. At this point - or if there was no genus one subcurve to start with -, proceed as follows. Let $Z$ be the minimal subcurve of genus two in $\mathcal C_{j,0}$; let $q_1$ the point of $Z$ closest to $p_1$.
 \begin{enumerate}
  \item If $(Z,q_1)$ is Weierstrass, let $\mathcal B_{j+1}$ be obtained as the blow-up of $\mathcal C_j$ at $q_1$, ``three times'' at all the (other) points $\{\sigma_{1,j},\ldots,\sigma_{n,j}\}\cap Z$ (if $p_1\in Z$), and ``twice'' at all the (other) nodes of $\mathcal C_{j,0}$ such that one of their branches is in $Z$, and the other is not (if $q_1\neq p_1$). Call $S_h$ the exceptional divisors closest to $\tilde Z$, and $R_h$ the second closest. Consider then the line bundle
  \[\mathcal L_{j+1}=\omega_{\mathcal B_{j+1}/\dvr}(3\tilde Z+2\sum_{h=1}^{l_j-1}S_h+\sum_{h=1}^{l_j-1}R_h+\tilde \sigma_{1,j}+\ldots+\tilde\sigma_{n,j});\]
  it is indeed a line bundle, again by assumption \ref{cond:regnodes}. By the contraction lemma \ref{lem:contraction}... By the classification of semistable tails, $\mathcal C_{j+1,0}$ acquires a singularity of type $I\!I\!I_{l_i}$, and $p_1$ is connected to the singular branch.
  \item If $(Z,q_1)$ is not Weierstrass, blow up $\mathcal C_j$ at $q_1$ and at the point of $Z$ which is conjugate to $q_1$; let $\mathcal B_{j+1}$ be obtained by further blowing up $\mathcal C_j$ ``twice'' at all the (other) points $\{\sigma_{1,j},\ldots,\sigma_{n,j}\}\cap Z$ (if $p_1\in Z$), and only once at all the (other) nodes of $\mathcal C_{j,0}$ such that one of their branches is in $Z$, and the other is not (if $q_1\neq p_1$). Call $R_h$ the exceptional divisors closest to $\tilde Z$. Consider then the line bundle
  \[\mathcal L_{j+1}=\omega_{\mathcal B_{j+1}/\dvr}(2\tilde Z+\sum_{h=1}^{l_j-1}R_h+\tilde \sigma_{1,j}+\ldots+\tilde\sigma_{n,j});\]
  it is indeed a line bundle, again by assumption \ref{cond:regnodes}. By the contraction lemma \ref{lem:contraction}... By the classification of semistable tails, $\mathcal C_{j+1,0}$ acquires a singularity of type $I\!I_{l_i+1}$, and $p_1$ is connected to one of the twin branches.
 \end{enumerate}
 Notice again that the number of rationally attached rational components strictly decreases at every step, hence after finitely many steps we obtain $\mathcal C_{t,0}=Z$ and there are no disconnecting nodes.\end{comment}
 \medskip
 
 \emph{Uniqueness of limits.} By the theorem of semistable reduction \cite{DM}, we may find a diagram
 \bcd
 & \mathcal C^{ss}\ar[ld,"\phi" above]\ar[dr,"\phi^\prime" above] & \\
 \mathcal C\ar[dr] & & \mathcal C^\prime\ar[dl] \\
 & \dvr &
 \ecd
 that extends the isomorphism between the generic fibers, with $\mathcal C^{ss}$ regular.
 
 \textbf{Claim:} If $\mathcal C^\prime_0$ has only singularities of genus $\leq i$ ($i=0,1$), then so does $\mathcal C_0$.
 
 First assume that $\mathcal C^\prime_0$ has only nodes. If $\mathcal C_0$ has a singular point $x$ of genus one, $E:=\phi^{-1}(x)$ is an unmarked subcurve of arithmetic genus one and level $\leq m+1$ of $\mathcal C^{ss}_0$; then so is $\phi^\prime(E)$ (recall that $\phi^\prime$ is a contraction, therefore it has connected fibers, which excludes the possibility that $\phi^\prime$ lowers the genus of $E$ by realising a finite cover of a line), contradicting the $m$-stability of $\mathcal C^\prime$. Argue similarly if $x$ is a genus two singularity with $\leq m$ branches. Finally, if $x$ is dangling $I\!I_{m+1}$, there is a $-1$-curve $R$ adjacent to $\phi^{-1}(x)$; $\phi^\prime$ must contract $R$ by DM stability of $\mathcal C^\prime$, hence $\phi^\prime(\phi^{-1}(x))$ is a genus two curve of level $\leq m$, which is again absurd.
 
 The case $i=1$ is more delicate; suppose $\mathcal C_0$ has a singularity $x$ of genus two; the case of a dangling $I\!I_{m+1}$ can be excluded as above. Then $\mathcal C^{ss}_0=Z\cup R_1\cup \ldots\cup R_l$, with $Z=\phi^{-1}(x)$ and $l\leq m$. If $Z$ has geometric genus two, or is irreducible of geometric genus one, $\phi^\prime(Z)$ violates $m$-stability of $\mathcal C^\prime$. If $Z$ contains a unique subcurve $E$ of genus one, with a rational chain $R$ connecting $E$ to itself, then $p_1$ must affere to $R$ by the analysis of semistable tails of genus two. Therefore $\lev(E)\leq (l-1)+2\leq m+1$. Similarly, if $Z$ contains two subcurves of genus one $E_1$ and $E_2$, then $(\lev(E_1)-1)+(\lev(E_2)-1)\leq l$, hence at least one of the two has level $\leq m+1$ (the level of the other one has to be positive anyway). In all cases, $\phi^\prime(E)$ contradicts $m$-stability of $\mathcal C^\prime$.
 
 \textbf{Claim:} We may assume that $\mathcal C^{ss}$ contains either no $-1$-curve, or only one, which is contracted by neither $\phi$ nor $\phi^\prime$.
 
 If there is a $-1$-curve contracted by both, $\phi$ and $\phi^\prime$ factor through a smaller regular model. Assume there is a $-1$-curve not contracted by $\phi$. Then, by stability, its image is one of the special branches of a dangling singularity of type $I\!I_{l+1}$, $l\leq m$; call $x$ the singular point, and $Z=\phi^{-1}(x)$. We may then write $\mathcal C_0=Z\cup R_0\cup\ldots\cup R_l$, with $R_0=R$, and $R_1$ (the tail including) the preimage of the other special branch, which contains $p_1$. Is it possible that $\phi^\prime$ contracts a different subcurve than $Z$? By the previous claim, $\phi^\prime$ has to contract a subcurve of genus two $Z^\prime$. If $Z^\prime$ contains $R$ and is of shape $I\!I$, then it is strictly larger than $Z$, therefore its contraction will not be dangling and it will have at least $m+1$ branches, by the condition on the level of the minimal genus two subcurve of $\mathcal C_0$. Otherwise $Z^\prime$ can be of shape $I\!I\!I$; this forces $R_0$ and $R_1$ to meet on a trunk $T$, that is attached to a Weierstrass point of the core of $\mathcal C^{ss}_0$. If $Z^\prime$ starts from the top of $T$ or further away from the core along $R_1$, then $Z^\prime$ contains $Z$ strictly, therefore $\mathcal C^\prime_0$ will have a singularity of type $I\!I\!I_{\geq m+1}$, by the assumption on the level of the minimal subcurve of genus two of $\mathcal C_0$. On the other hand, if $Z^\prime$ starts closer to the core than the top of $T$, then the level of the minimal subcurve of genus two of $\mathcal C^\prime$ will be at most $m$. In fact this argument proves more, namely that if $\mathcal C_0$ has a dangling $I\!I$ singularity, then the exceptional loci of $\phi$ and $\phi^\prime$ coincide, therefore $\mathcal C\cong\mathcal C^\prime$ (see below).
 
 \textbf{Claim:} The exceptional loci of $\phi$ and $\phi^\prime$ coincide.
 
 If $\mathcal C_0$ has only nodes, then so does $\mathcal C^\prime_0$, and we can conclude by the uniqueness part of the stable reduction theorem \cite{DM}. The meat is in the higher genus components of the exceptional loci.
 
 If $\mathcal C_0$ has a genus one singularity $x$, then it cannot have a genus two singularity, so neither can $\mathcal C^\prime_0$. If $\mathcal C_0$ has a second genus one singularity $y$, let $E_1=\phi^{-1}(x)$ and $E_2=\phi^{-1}(y)$; they are disjoint balanced subcurves of genus one and level $\leq m+1$ in $\mathcal C^{ss}_0$, therefore $\phi^\prime$ must contract them. Enlarging the contraction radius of any one of them would produce a singularity with at least $m+2$ branches, unless by enlarging we make them touch, in which case we should contract to a genus two singularity, which is also not allowed. The case of a single genus one singularity with a genus one branch, or with a disjoint subcurve of genus one, is entirely similar. In the case of a genus one singularity with two branches joined by a (possibly empty) rational chain $R$, notice that the argument that expanding the contraction radius increases the number of branches of $\phi^\prime(E^\prime)$ above $m+1$ may fail in the case that the contraction circle includes the entire $R$, but in this case we would find a genus two singularity in $\mathcal C^\prime_0$.
 
 Finally, if $\mathcal C_0$ has a genus two singularity $x$ - the case of a dangling $I\!I_{m+1}$ was dealt with above -, write $\mathcal C^{ss}_0=Z\cup R_1\cup\ldots\cup R_l$, with $Z=\phi^{-1}(x)$ and $l\leq m$. Now $\phi^\prime(Z)$ must be a point $x^\prime$, by stability considerations. If $p_1$ afferes to a non-Weierstrass point of $Z$, $x^\prime$ must be of type $I\!I$; therefore $Z^\prime=(\phi^\prime)^{-1}(x^\prime)$ has shape $I\!I$, which is determined by one parameter. Since $Z\subsetneq Z^\prime$ implies $x^\prime$ has at least $m+1$ branches by level considerations, we conclude $Z=Z^\prime$. If instead $p_1$ afferes to a Weierstrass point, there are multiple possibilities. If $x$ is type $I\!I\!I$, and $x^\prime$ as well, the argument is as before; if instead $x^\prime$ is of type $I\!I$, notice that $Z^\prime$ must start further away from the core than $Z$ (otherwise $Z^\prime\subsetneq Z$, hence the level of $\mathcal C^\prime_0$ is not enough), but then $Z\subsetneq Z\prime$, and the singularity of $\mathcal C^\prime_0$ is too bad. The other cases are symmetric.
 
 The claim now follows from the observation that the exceptional loci of $\phi$ and $\phi^\prime$ are the fibers over higher genus singularity (call them $Z$) union those rational curves with only two special points that are disjoint from $Z$.
 
 \textbf{Claim:} The generic isomorphism between $\mathcal C$ and $\mathcal C^\prime$ extends over $\dvr$.
 
 Follows from \cite[Lemma1.13]{Debarre}.
\end{proof}

\begin{dfn}
 Fix positive integers $m<n$. Let $(C,p_1,\ldots,p_n)$ be a connected, reduced, complete curve of arithmetic genus two, marked by smooth points. We say that $C$ is $m$-stable if:
 \begin{enumerate}
  \item\label{cond:sing} $C$ has only nodes; elliptic $l$-fold points, $l\leq m+1$; type $I\!I_{\leq m}$, dangling $I\!I_{m+1}$, and type $I\!I\!I_{\leq m}$ genus two singularities as singular points.
  \item\label{cond:lev2} If $Z$ is a connected subcurve of arithmetic genus two, then $\lev(Z)>m$.
  \item\label{cond:lev1} If $E$ is a nodally attached subcurve of arithmetic genus one, then $\lev(E)>m+1$.
  \item\label{cond:aut} $H^0(C,\Omega_C^\vee(-\sum_{i=1}^n p_i))=0$.
  \item\label{cond:p1} If $C$ contains a singularity of genus two, $p_1$ is connected (through a rational chain) to one of the distinguished branches.
  \item If there is a Gorenstein subcurve of genus one and level less than $m+2$, then it is not nodally attached and $p_1$ afferes to it.
 \end{enumerate}
\end{dfn}
\begin{rem}
Non-Gorenstein subcurves appear by taking the union of some - but not all - the branches of a Gorenstein singularity of genus one or two.
\end{rem}



\bibliographystyle{alpha}
\bibliography{genus_two}
%\newpage

\noindent Luca Battistella\\
Max Planck Institut f\"ur Mathematik - Bonn \\
\texttt{battistella@mpim-bonn.mpg.de}\\


\end{document}

